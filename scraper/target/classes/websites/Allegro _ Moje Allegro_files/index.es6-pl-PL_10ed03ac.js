((e,t)=>{for(var i in t)e[i]=t[i]})(window,(e=>{var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=(e,t,s)=>{i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=(e,t)=>{if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,(t=>e[t]).bind(null,r));return s},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,"a",t),t},i.o=(e,t)=>({}.hasOwnProperty.call(e,t)),i.p="https://assets.allegrostatic.com/opbox-user-menu/",i(i.s=0)})({"+GN7"(e,t){e.exports="2ac"},0(e,t,i){e.exports=i("O14P")},O14P(e,t,i){i.r(t);var s=i("+GN7"),r=i.n(s);function n(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t];for(var s in i)e[s]=i[s]}return e}var a={set(e,t){var i=n(arguments[2]),s=Object.keys(i).map(e=>{var t=i[e];return!0===t?";"+e:";"+("maxAge"===e?"max-age":e)+"="+(""+t).split(";")[0]}).join("");return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s},get(e){var t=document.cookie;if(!t)return e?void 0:{};var i=t.split("; ").reduce((e,t)=>{var i=t.split("="),s=decodeURIComponent(i[0]),r=decodeURIComponent(i[1]);return e[s]=r,e},{});return e?i[e]:i},remove(e){var t=n(arguments[1],{expires:"Thu, 01 Jan 1970 00:00:01 GMT"});return this.set(e,"",t)}};class o{constructor(e){this.header=e}activate(){"_ldlb7 _33b40_1XvOt".split(" ").forEach(e=>{this.header.classList.add(e)}),this.header.setAttribute("aria-selected",!0)}deactivate(){"_ldlb7 _33b40_1XvOt".split(" ").forEach(e=>{this.header.classList.remove(e)}),this.header.setAttribute("aria-selected",!1)}addClickListener(e){this.header.addEventListener("click",e)}addKeyUpListener(e){this.header.addEventListener("keyup",e)}removeClickListener(e){this.header.removeEventListener("click",e)}removeKeyUpListener(e){this.header.removeEventListener("keyup",e)}}class c{constructor(e,t=window){this.marker=t.opbox.boxViewsMarker,this.pane=e}activate(){"_152v3 _1bo4a".split(" ").forEach(e=>{this.pane.classList.add(e)}),this.marker.recursivelyMarkBoxAsVisible(this.pane)}deactivate(){"_152v3 _1bo4a".split(" ").forEach(e=>{this.pane.classList.remove(e)}),this.marker.recursivelyMarkBoxAsHidden(this.pane)}}class h{constructor(e,t){this.header=new o(e),this.pane=new c(t)}activate(){this.header.activate(),this.pane.activate()}deactivate(){this.header.deactivate(),this.pane.deactivate()}addClickListener(e){this.header.addClickListener(e)}addKeyUpListener(e){this.header.addKeyUpListener(e)}removeClickListener(e){this.header.removeClickListener(e)}removeKeyUpListener(e){this.header.removeKeyUpListener(e)}}class d{constructor(e){this.tabClickListeners=[],this.tabPressListeners=[],this.tabsWrapper=e.querySelector('[data-role="user-menu-authenticated"]'),this.tabs=(e=>{const t=Array.from(e.querySelectorAll('[data-role="user-menu-tab-pane"]'));return Array.from(e.querySelectorAll('[data-role="user-menu-tab-header"]'),(e,i)=>new h(e,t[i]))})(e)}initialize(){this.attachListeners()}terminate(){this.detachListeners()}setActivateTab(e){this.tabs.forEach((t,i)=>{i===e?t.activate():t.deactivate()})}onTabClick(e){this.setActivateTab(e)}onTabPress(e,{key:t}){"ENTER"===t.toUpperCase()&&this.setActivateTab(e)}attachListeners(){this.tabs.forEach((e,t)=>{const i=this.onTabClick.bind(this,t),s=this.onTabPress.bind(this,t);this.tabClickListeners.push(i),this.tabPressListeners.push(s),e.addClickListener(i),e.addKeyUpListener(s)})}detachListeners(){this.tabs.forEach((e,t)=>{e.removeClickListener(this.tabClickListeners[t]),e.removeKeyUpListener(this.tabPressListeners[t])})}}class l{constructor(e,{location:t}=window){this.location=t,this.authButtons=e.querySelectorAll('[data-role="auth-button"]')}changeOriginUrlParam(){const{pathname:e="",search:t=""}=this.location;t.match(/origin_url/)||this.authButtons.forEach(i=>{const s="?origin_url="+encodeURIComponent(`${e}${t}`);i.setAttribute("href",`${i.href}${s}`)})}initialize(){this.changeOriginUrlParam()}}function u(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class p{constructor({baseNode:e,props:t,services:i}){u(this,"getNotificationService",()=>this.services.get("opbox-notification-service")),u(this,"updateNotificationNodes",e=>{this.notificationNodes.forEach(t=>{const i=e[t.dataset.notificationTag];var s;t.textContent=(s=i)<1?"":s>99?"99+":s})}),u(this,"handleOnResetTriggerClick",e=>{const t=e.currentTarget.querySelector("[data-notification-tag]"),{notificationTag:i}=t.dataset;this.getNotificationService().then(e=>{e.reset(i)})}),this.props=t,this.services=i,this.notificationNodes=e.querySelectorAll("[data-notification-tag]"),this.resetTriggerNodes=e.querySelectorAll("[data-notification-reset-trigger]")}initialize(){!this.props.isAnonymised&&this.props.isAuthenticated&&(this.getNotificationService().then(e=>{e.getNotifications(this.updateNotificationNodes)}),this.resetTriggerNodes.forEach(e=>{e.addEventListener("click",this.handleOnResetTriggerClick)}))}terminate(){this.resetTriggerNodes.forEach(e=>{e.removeEventListener("click",this.handleOnResetTriggerClick)})}}class m{constructor(e){u(this,"clickHandler",e=>{e.preventDefault();const{hash:t=""}=e.currentTarget,{pathname:i,search:s,hash:r}=this.window.location;this.window.history.pushState({previousHash:r},this.window.document.title,`${i}${s}${t}`),this.window.dispatchEvent(new HashChangeEvent("hashchange"))}),this.node=e.querySelector('[data-role="user-menu-user-inbox"]'),this.window=window}attachListener(){this.node&&this.node.addEventListener("click",this.clickHandler)}removeListener(){this.node&&this.node.removeEventListener("click",this.clickHandler)}}const v={withCredentials:!0,headers:{Accept:"application/vnd.allegro.internal.v1+json"}},b=e=>t=>t.name===e,f=({userAttributesGroups:e=[]}={})=>{const{attributes:t=[]}=e.find(b("user"))||{},i=t.find(b("firstName"))||{},s=t.find(b("login"))||{},r=t.find(b("email"))||{},n="Company"===(t.find(b("type"))||{}).value;return{displayName:n?s.value:i.value||s.value,login:n?"":s.value,email:r.value}};window.opbox.component.register({prototypeName:"allegro.user.menu",clientImplementationVersion:r.a},class{constructor({baseNode:e,props:t,services:i,targetWindow:s=window}){this.targetWindow=s,this.baseNode=e,this.services=i,this.props=t,this.userInboxLink=new m(e)}mountTabs(){this.tabs=new d(this.baseNode),this.tabs.initialize()}mountNotificationHandlder(){this.notificationsHandler=new p({baseNode:this.baseNode,services:this.services,props:this.props}),this.notificationsHandler.initialize()}mountAnonymised(){var e,t;this.isUserPresentInCookie=!!(e=a,(t="qeppo_login2",i=window.console,s=window.opbox.reportError)=>{const r=e.get(t);if(r)try{return JSON.parse(r)}catch(n){i.error(n),s&&s.noticeError(n)}})(),this.isUserPresentInCookie&&((e=window)=>e.opbox.edge.get("/user-attributes",v).then(e=>e.data).then(f))().then((t=this.baseNode,({displayName:e="",login:i="",email:s=""}={})=>{const r=t.querySelector('[data-role="user-menu-user-name"]');r&&(r.textContent=e);const n=t.querySelector('[data-role="user-menu-user-login"]');n&&(n.textContent=`(${i})`);const a=t.querySelector('[data-role="user-menu-user-email"]');a&&(a.textContent=s)})).then((e=>()=>{const t=e.querySelector('[data-role="user-menu-authenticated"]'),i=e.querySelector('[data-role="user-menu-unauthenticated"]');if(t&&i){const e="mpof_5r".split(" ");i.classList.add(...e),t.classList.remove(...e)}})(this.baseNode)).then(()=>this.mountAuthenticated())}unmountAnonymised(){this.isUserPresentInCookie&&this.unmountAuthenticated()}mountAuthenticated(){this.mountTabs(),this.mountNotificationHandlder(),this.userInboxLink.attachListener()}unmountAuthenticated(){this.userInboxLink.removeListener(),this.notificationsHandler.terminate(),this.tabs.terminate()}mountUnauthenticated(){new l(this.baseNode).initialize()}onMount(){return this.props.isAnonymised?this.mountAnonymised():this.props.isAuthenticated?this.mountAuthenticated():this.mountUnauthenticated()}onUnmount(){this.props.isAnonymised?this.unmountAnonymised():this.props.isAuthenticated&&this.unmountAuthenticated()}})}}));
//# sourceMappingURL=index.es6-pl-PL_10ed03ac.js.map