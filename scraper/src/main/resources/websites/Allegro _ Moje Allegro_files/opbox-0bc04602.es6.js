const e=e=>e>=200&&e<=204,t=(e,t,r,n)=>{const{status:s,responseText:i}=e,o=t(s),a=(e=>e.split("\n").reduce((e,t)=>{const r=t.indexOf(":"),n=t.substr(0,r).trim().toLowerCase(),s=t.substr(r+1).trim();return n&&(e[n]=e[n]?`${e[n]}, ${s}`:s),e},{}))(e.getAllResponseHeaders());let c={};try{c=JSON.parse(i)}catch(l){c=i}o?r({status:s,data:c,headers:a}):n({status:s,data:c,message:`Request failed with status code ${s}`,headers:a})};var r=()=>{let r=null;const n=(n,s,i,{headers:o={},validateStatus:a=e,withCredentials:c=!1,cancelLast:l=!1,onUploadProgress:d})=>{l&&null!==r&&r.abort();const h=((e,t,r,n,s,i)=>{const o=new XMLHttpRequest;return o.open(e,t,!0),Object.keys(n).forEach(e=>{o.setRequestHeader(e,n[e])}),o.withCredentials=s,o.upload&&i&&o.upload.addEventListener("progress",i),o.send(((e,t)=>["POST","PUT","PATCH"].includes(e)?"object"!=typeof t||t instanceof Blob||t instanceof FormData?t:JSON.stringify(t):null)(e,r)),o})(n,s,i,o,c,d);return r=h,((e,r)=>new Promise((n,s)=>{e.readyState===XMLHttpRequest.DONE?t(e,r,n,s):e.onreadystatechange=()=>{e.readyState===XMLHttpRequest.DONE&&(t(e,r,n,s),e.onreadystatechange=null)}}))(h,a)};return{request:n,get(e,t={}){return n("GET",e,{},t)},post(e,t,r){return n("POST",e,t,r)},put(e,t,r){return n("PUT",e,t,r)},patch(e,t,r){return n("PATCH",e,t,r)},delete(e,t={}){return n("DELETE",e,{},t)}}};const{assign:n}=Object;function s(e){return Array.isArray(e)}function i(e){return"object"==typeof e&&!s(e)&&null!==e}function o(e){return"string"==typeof e}function a(e){return void 0===e}function c(e){return"function"==typeof e}function l(e){return null===e||"object"!=typeof e||0===Object.keys(e).length}function d(e,t){return Array.from(e,t)}function h(e,t,r){return e?d(e.querySelectorAll(t),r):[]}function u(e,t,...r){return n(e.createElement(t),...r)}function m(e=""){return e.includes("/metrum/")}function p(e=""){return e.split("/metrum/")[1].split("/")[0]}function g(){}function b(e,t,r){let n;return function(...s){const i=this,o=r&&!n;return clearTimeout(n),n=setTimeout(()=>{n=null,r||e.apply(i,s)},t),o&&e.apply(i,s),n}}function f(e,t){return e.concat(t)}const v=/Version\/[\d.]+.*Safari/,y=/iPhone|iPad|iPod|Android/i,E=e=>(t,r)=>Object.assign({},t,{},e(r)),x=(e,t,r)=>e.addEventListener(t,r),w=()=>(new Date).getTime();function C(e){return`<link type="text/css" rel="stylesheet" crossorigin="" href="${e}"/>`}const P=e=>e.opbox||{};class k{constructor({targetWindow:e}={}){this.targetWindow=e}get document(){return this.targetWindow.document}}class S extends Error{constructor(e){super(e),this.message=e,this.name="PageRenderingError"}}class A{constructor({data:e,headers:t}={}){this.data=e,this.headers=t}get valid(){return i(this.data)}}class T{constructor(e={}){this.dataSources=e}resolve(e,t){const{value:r}=e;if("DATA_SOURCE"===e.type){const e=this.dataSources[r];return Object.assign({},e&&e.data&&{[t]:e.data},{},e&&!l(e.metadata)&&{[`${t}.$meta`]:e.metadata})}return{[t]:r}}}class N{constructor({boxes:e={},boxNameToIdMap:t={},dataSources:r={},meta:n={}}={}){this.boxes=e,this.boxNameToIdMap=t,this.dataSources=r,this.meta=n,this.parameterResolver=new T(this.dataSources)}get resolved(){return{boxes:this.resolvedBoxes,boxNameToIdMap:this.boxNameToIdMap,dataSources:this.dataSources,meta:this.meta}}get resolvedBoxes(){return function(e=this,t,r){const n={};return Object.keys(e).forEach(s=>{n[s]=t.call(r,e[s],s,e)}),n}(this.boxes,e=>{const t=Object.keys(e).reduce((t,r)=>{const s=this.parameterResolver.resolve(e[r],r);return n(t,s)},{});return n(t,this.pageProperties)})}get pageProperties(){return Object.keys(this.meta).filter(e=>0===e.indexOf("$page.")).reduce((e,t)=>n(e,{[t]:this.meta[t]}),{})}}function I({href:e},t={}){const r=new URL(e);return r.search=((e,t)=>{const r=new URLSearchParams(e.search);return Object.entries(t).map(([e,t])=>(Array.isArray(t)?(r.delete(e),t.forEach(t=>r.append(e,t))):r.set(e,t),r)),r})(r,t).toString(),r.toString()}function V(e){return e>=200&&e<300||502===e}class R{constructor({targetWindow:e=window,httpClient:t,reportError:r,fragmentRenderCallback:n,boxRenderCallback:s}){this.httpClient=t,this.reportError=r,this.targetWindow=e,this.fragmentRenderCallback=n,this.boxRenderCallback=s,this.render={box:this.renderBox.bind(this),fragment:this.renderFragment.bind(this)}}getPageData(e){const t={headers:{Accept:"application/vnd.opbox-web.v2+json"},cancelLast:!0,validateStatus:V};return this.httpClient.get(e,t).then(e=>{const t=new A(e);if(!t.valid)throw new S("Opbox response is invalid.");return new N(t.data)})}handleError(e){return this.reportError(Error(e)),Promise.reject(e)}renderSubtree({boxId:e,additionalQueryParameters:t={},isPlaceholder:r=!1}={}){return this.targetWindow.console.warn("Warning: renderSubtree method is deprecated and will be removed soon. Use render.box method instead."),this.renderBox({boxId:e,additionalQueryParameters:t,isPlaceholder:r})}renderBox({boxId:e,additionalQueryParameters:t={},isPlaceholder:r=!1}={}){return e?this.httpClient.get(I(this.targetWindow.location,t),{headers:{Accept:"application/vnd.opbox-web.subtree+json","x-box-id":e},cancelLast:!1,validateStatus:V}).then(({data:t})=>this.boxRenderCallback({boxId:e,data:t,isPlaceholder:r})):this.handleError("Missing 'boxId' property!")}renderFragment({pathname:e,additionalQueryParameters:t={}}={}){if(!e)return this.handleError("Missing 'pathname' property!");if(!(e=>!!e.match(/^(\/[a-zA-Z0-9\-]+)*\/{0,1}$/))(e))return this.handleError("Invalid 'pathname' property!");const{href:r}=new URL(`${this.targetWindow.location.origin}${e}`);return this.httpClient.get(I({href:r},t),{headers:{Accept:"application/vnd.opbox-web.subtree+json"},cancelLast:!1,validateStatus:V}).then(({data:t})=>this.fragmentRenderCallback({pathname:e,data:t}))}createAPI(){return{renderSubtree:this.renderSubtree.bind(this),render:this.render}}}class O{constructor({meta:e={}}={},t){this.appContext=t,this.meta=e}updateMetaRobots(){const e=this.appContext.document.querySelector('head meta[name="robots"]');e&&this.meta&&e.setAttribute("content",[this.meta.noindexCondition?"noindex":"index",this.meta.nofollowCondition?"nofollow":"follow"].join(", "))}render(){this.updateMetaRobots()}}class B{constructor({appContext:e,analytics:t,updateComponentCallback:r=g,beforeUpdateComponentCallback:n=g}){this.appContext=e,this.rawData=new N,this.listeners={},this.analytics=t,this.updateComponentCallback=r,this.beforeUpdateComponentCallback=n}registerListener(e,t=g,r=g){if(this.rawData.boxes[e]){const r=this.rawData.resolved.boxes[e];setTimeout(()=>{t(r)},0)}this.listeners[e]={onChange:t,onProgress:r}}triggerChangeListener(e){this.rawData=e;const{boxes:t,boxNameToIdMap:r,meta:n}=this.rawData.resolved;Object.entries(t).forEach(([e,t])=>{a(t)||this.updateComponentCallback(e,t)}),Object.keys(r).forEach(e=>{const n=t[r[e]];if(!a(n)){const t=this.listeners[e];t&&c(t.onChange)&&setTimeout(()=>t.onChange(n),0)}});const{defaultCustomParams:s}=n;this.analytics&&this.analytics.updateCustomParams(s),new O({meta:n},this.appContext).render()}triggerProgressListener(){this.beforeUpdateComponentCallback(),Object.keys(this.listeners).forEach(e=>{const t=this.listeners[e];t&&c(t.onProgress)&&setTimeout(()=>t.onProgress(),0)})}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var W,M=(((e,t)=>{e.exports=(()=>{function e(e){return e instanceof Object&&e.constructor===Object}function t(r,n){var s=r,i=n;e(r)||(s={}),e(n)||(i={});var o=Object.keys(s),a=Object.keys(i),c={};return o.forEach(r=>{-1!==a.indexOf(r)?null===s[r]?c[r]=i[r]:e(s[r])&&e(i[r])?c[r]=t(s[r],i[r]):c[r]=i[r]:c[r]=s[r]}),a.forEach(e=>{-1===o.indexOf(e)&&(c[e]=i[e])}),c}return function(r){var n=r;e(r)||(n={});for(var s=arguments.length,i=Array(s>1?s-1:0),o=1;o<s;o++)i[o-1]=arguments[o];return i.forEach(r=>{e(r)&&(n=t(n,r))}),n}})()})(W={exports:{}}),W.exports);const L=e=>h(e,"[data-analytics-enabled]"),j=e=>{const t=h(e,"[data-analytics-proxied]").reduce((e,t)=>{const r=L(t).filter(t=>!e.includes(t));return r.length?f(e,r):e},[]);return L(e).filter(e=>!t.includes(e))};var U=Object.freeze({__proto__:null,SEEN_ATTRIBUTE_NAME:"data-seen",VISIBLE_FOR_ATTRIBUTE_NAME:"data-visible-for",BOX_VIEW_ENABLED_ATTRIBUTE_NAME:"data-analytics-enabled",BOX_VIEW_PROXIED_ATTRIBUTE_NAME:"data-analytics-proxied",getAllBoxViewEnabledNodes:L,getBoxViewEnabledNodes:j,getElementVisibleDimensionLength:(e,t,r,n)=>e>0?e<r?t<r?t-e:r-e:0:t<0?0:t<r?t:n,getUserViewport:e=>({width:e.innerWidth,height:e.innerHeight})});class H{constructor({targetWindow:e,onCycleComplete:t}){this.window=e,this.document=this.window.document,this.onCycleComplete=t,this.initTimeStamp=w(),this.engagementCycleStartTime=null,this.engagementTime=0,this.maxScrollBottom=this.getScrollBottom(),this.previousInteractionTime=null,this.handleInteraction=this.handleInteraction.bind(this),this.refreshEngagementCycle=this.refreshEngagementCycle.bind(this),x(e.document,"click",this.handleInteraction),x(e.document,"mousemove",this.handleInteraction),x(e.document,"keydown",this.handleInteraction),x(e.document,"scroll",this.handleInteraction),x(e,"beforeunload",this.refreshEngagementCycle),this.startEngagementCycles()}getTimeSpentOnPage(){return w()-this.initTimeStamp}updateEngagementTime(e){if(!this.previousInteractionTime)return;let t;if(this.previousInteractionTime<this.engagementCycleStartTime){const r=e-this.engagementCycleStartTime,n=this.engagementCycleStartTime-this.previousInteractionTime;t=Math.min(r,2e3-n)}else{const r=e-this.previousInteractionTime;t=Math.min(r,2e3)}this.engagementTime+=t}updateMaxScrollBottom(){const e=this.getScrollBottom();e>this.maxScrollBottom&&(this.maxScrollBottom=e)}getScrollBottom(){const{innerHeight:e,scrollY:t}=this.window;return e+(t||this.document.documentElement.scrollTop)}getPageHeight(){const{body:e,documentElement:t}=this.document;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)}endCycle(e){this.updateEngagementTime(e),this.engagementTime>0&&this.onCycleComplete({engagementTime:this.getEngagementTimeWithLimit(),scrollBottom:this.maxScrollBottom,pageHeight:this.getPageHeight()});const t=e-2e3;this.previousInteractionTime<t&&(this.previousInteractionTime=null),this.engagementTime=0,this.engagementCycleStartTime=e,this.maxScrollBottom=this.getScrollBottom()}getEngagementTimeWithLimit(){return Math.min(this.engagementTime,6e3)}handleInteraction(){const e=this.getTimeSpentOnPage();this.updateEngagementTime(e),this.updateMaxScrollBottom(),this.previousInteractionTime=e}refreshEngagementCycle(){this.endCycle(this.getTimeSpentOnPage())}startEngagementCycles(){this.engagementCycleStartTime=this.getTimeSpentOnPage(),setInterval(this.refreshEngagementCycle,6e3)}}const _=(e="",t)=>e.slice(0,t);class D{constructor({targetWindow:e,send:t}={}){this.window=e,this.send=t,this.counter=0}handleError({error:e={}}={}){const{name:t,message:r,stack:n}=e;this.counter<100&&(this.counter+=1,this.send({type:t,message:_(r,800),stack:_(n,800)}))}initialize(){x(this.window,"error",this.handleError.bind(this))}}const $=(e,t)=>{const r={};for(let s=0;s<e.attributes.length;s+=1){const i=e.attributes[s];0===i.name.indexOf(t)&&(r[(n=i.name.replace(t,""),n.replace(/^([A-Z])|[\s|_-](\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()))]=i.value)}var n;return r},q=({contextNode:e,customParams:t={}})=>{const r=$(e,"data-analytics-view-opbox-custom-"),n=Object.keys(r).length?{_opbox:r}:{};return M($(e,"data-analytics-view-custom-"),n,t)},z=({contextNode:e,coordinates:t={},destinationUrl:r="",customParams:n={},isNewTab:s})=>{const i=s?{isNewTab:s}:{},o=Object.assign({},$(e,"data-analytics-click-opbox-custom-"),{destinationUrl:r},i,{},t);return M($(e,"data-analytics-click-custom-"),{_opbox:o},n)},F=({contextNode:e,customParams:t={}})=>{const r=$(e,"data-analytics-interaction-custom-"),n=$(e,"data-analytics-interaction-opbox-custom-"),s=Object.keys(n).length?{_opbox:n}:{};return M(r,s,t)};function J(e,t,r){return e.addEventListener(t,r),{remove(){e.removeEventListener(t,r)}}}class X{constructor({targetWindow:e,config:t,cookieMonsterClient:r,boxViewsMarker:n,sendPerformanceMetrics:s}){const{cookieMonster:{boxViewDisabled:i,isEngagementMeasuringEnabled:o,isErrorReporterEnabled:a,defaultCustomParams:c={}}={}}=t;this.targetWindow=e,this.document=this.targetWindow.document,this.boxViewDisabled=i,this.isEngagementMeasuringEnabled=o,this.isErrorReporterEnabled=a,this.cookieMonsterClient=r,this.boxViewsMarker=n,this.defaultCustomParams=c,this.eventCallbacks=[],this.sendPerformanceMetrics=s||g,this.engagementObserver=null,this.errorReporter=new D({targetWindow:e,send:this.sendErrorEvent.bind(this)});const l=(({navigator:{userAgent:e=""}={}}={})=>e)(e);this.isMobile=(e=>!!e.match(y))(l),this.isSafari=(e=>!!e.match(v))(l),this.isFirefox=(e=>e.toLowerCase().includes("firefox"))(l)}initialize(){this.cookieMonsterClient.initialize(),this.isEngagementMeasuringEnabled&&(this.engagementObserver=new H({targetWindow:this.targetWindow,onCycleComplete:this.sendPingEvent.bind(this)})),this.isErrorReporterEnabled&&this.errorReporter.initialize(),this.eventHandlers=[J(this.document,"change",this.handleChange.bind(this)),J(this.document,"click",this.handleClick.bind(this)),J(this.document,"mousedown",this.handleLinkClick.bind(this)),J(this.document,"submit",this.handleSubmit.bind(this)),J(this.document,"contextmenu",this.handleClick.bind(this)),J(this.document,"boxView",this.handleBoxView.bind(this)),J(this.targetWindow,"DOMContentLoaded",this.detectAdblock.bind(this))]}teardown(){this.eventHandlers.forEach(e=>{e.remove()})}callEventCallbacks(e){this.eventCallbacks.length&&this.eventCallbacks.forEach(t=>t(e))}sendEvent({contextNode:e,action:t,label:r="",value:n,customParams:s={}}={}){if(!e||!t)return{};const i=e.closest("[data-analytics-category]").getAttribute("data-analytics-category"),o=e.closest("[data-box-name]").getAttribute("data-box-name"),a=e.closest("[data-box-id]"),c=a&&a.getAttribute("data-box-id"),l=(e=>{const t=e.closest("[data-analytics-tags]");return t?((e,t)=>{const r=e.split(","),n=t.split(","),s=r.concat(n);return s.filter((e,t)=>e&&s.indexOf(e)===t)})(t.closest("[data-item]")?(e=>{const t=e&&e.closest("[data-box-name][data-analytics-tags]");return t&&t.getAttribute("data-analytics-tags")||""})(t):"",t.getAttribute("data-analytics-tags")||""):[]})(e),d=(e=>{const t=e.closest("[data-analytics-groups]");if(t){let e=decodeURIComponent(t.getAttribute("data-analytics-groups"));try{e=JSON.parse(e)}catch(r){return console.log(`JSON.parse error! Can not convert ${e} to JSON.`),[]}return e}return[]})(e),h=l.length?{analyticsTags:l}:{},u=d.length?{groups:d}:{},m=Object.assign({},h,{},u,{},c?{boxName:o,boxId:c}:{boxName:o}),p={category:i,action:t,label:r,value:n,customParams:M(Object.assign({},s),{_opbox:m},this.defaultCustomParams.ev)};return this.cookieMonsterClient.send("event",p),this.callEventCallbacks(p),p}sendPingEvent({engagementTime:e,scrollBottom:t,pageHeight:r}={}){const n={category:"Engagement",label:"ping",customParams:{et:e,sb:t,ph:r}};this.cookieMonsterClient.send("event",n),this.callEventCallbacks(n)}sendErrorEvent({type:e,message:t,stack:r}={}){const n={category:"BrowserError",label:e,value:t,customParams:{st:r}};this.cookieMonsterClient.send("event",n),this.callEventCallbacks(n)}sendClickEvent(e){this.sendEvent(Object.assign({},e,{action:"click"}))}sendContextmenuEvent(e){this.sendEvent(Object.assign({},e,{action:"contextmenu"}))}sendBoxInteractionEvent(e){this.sendEvent(Object.assign({},e,{action:"boxInteraction"}))}sendItemViewEvent(e){this.sendEvent(Object.assign({},e,{action:"itemView"}))}sendBoxViewEvent(e){this.sendEvent(Object.assign({},e,{action:"boxView"}))}sendFormSubmitEvent(e){this.sendEvent(Object.assign({},e,{action:"submit"}))}detectAdblock(){const e=u(this.document,"div",{innerHTML:"&nbsp;",className:"adsbox"});this.document.body.appendChild(e),this.targetWindow.setTimeout(()=>{const t=0!==e.offsetHeight;this.cookieMonsterClient.send("event",{category:"clearPV",action:t,customParams:this.defaultCustomParams.ev}),this.document.body.removeChild(e)},100)}handleClick(e){this.handleBoxInteraction(e),this.handleLinkClick(e)}handleBoxInteraction(e){if("function"!=typeof e.target.closest)return;const t=e.target.closest("[data-analytics-interaction]");if(!t)return;const r=F({contextNode:t}),n=t.getAttribute("data-analytics-interaction-label")||"",s=t.getAttribute("data-analytics-interaction-value")||t.textContent.trim();this.sendBoxInteractionEvent({contextNode:t,label:n,value:s,customParams:r})}shouldHandleBoxInteraction(e){return"mousedown"===e.type&&!this.isMobile&&(this.isSafari||this.isFirefox)&&"select-one"===e.target.type}handleLinkClick(e){if("function"!=typeof e.target.closest)return;if(this.shouldHandleBoxInteraction(e))return void this.handleBoxInteraction(e);const t=e.target.closest("a");if(!t||!t.hasAttribute("data-analytics-clickable"))return;const r=t.getAttribute("data-analytics-click-label")||"",n=t.getAttribute("data-analytics-click-value")||t.textContent.trim(),s="_blank"===t.getAttribute("target"),i=t.getAttribute("href"),o=e.pageX?{pageX:e.pageX,pageY:e.pageY}:{};"click"!==e.type||0!==e.button?"contextmenu"!==e.type?"mousedown"===e.type&&1===e.button&&this.sendClickEvent({contextNode:t,label:r,value:n,customParams:z({contextNode:t,coordinates:o,destinationUrl:i,isNewTab:!0})}):this.sendContextmenuEvent({contextNode:t,label:r,value:n,customParams:z({contextNode:t,coordinates:o,destinationUrl:i})}):this.sendClickEvent({contextNode:t,label:r,value:n,customParams:z({contextNode:t,coordinates:o,destinationUrl:i,isNewTab:s||e.metaKey||e.ctrlKey})})}handleChange(e){const t=e.target;if("select-one"===t.type&&t&&t.hasAttribute("data-analytics-selectable")){const{value:e}=t.options[t.selectedIndex],r=$(t,"data-analytics-select-custom-");this.sendEvent({contextNode:t,action:"change",value:e,customParams:r})}}handleSubmit(e){const t=e.target;if(!t||"FORM"!==t.nodeName||!t.hasAttribute("data-analytics-submittable"))return;const r=t.getAttribute("action");let n=d(t.elements).filter(e=>e.name).map(e=>({name:e.name,value:e.value})).sort((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase())).map(e=>`${e.name}=${e.value}`).join("&");n=n?`?${n}`:"";let s=n?r+n:r;s=encodeURI(s),this.sendFormSubmitEvent({contextNode:t,value:s,label:"submitForm"})}markParentBoxAsVisible(e){const t=e.parentNode&&e.parentNode.closest("[data-analytics-enabled]");this.boxViewsMarker&&t&&!t.hasAttribute("data-seen")&&this.boxViewsMarker.markBoxAsVisible(t,!0)}handleBoxView(e){const t=e.target;if(!t||!t.hasAttribute("data-analytics-enabled")||this.boxViewDisabled&&!t.hasAttribute("data-item")||d(t.childNodes).some(e=>e.classList&&e.classList.contains("opbox-fragment")))return;const r=t.getAttribute("data-analytics-view-value")||"",n=t.getAttribute("data-analytics-view-label")||"";let s=q({contextNode:t});if(t.firstChild&&t.firstChild.nodeType===Node.ELEMENT_NODE&&(s=Object.assign({},s,{},$(t.firstChild,"data-analytics-view-custom-"))),t.hasAttribute("data-item"))return this.markParentBoxAsVisible(t),void this.sendItemViewEvent({contextNode:t,label:n,value:r,customParams:s});s=Object.assign({},s,{},(e=>{if(!e)return{};const t=e.getAttribute("data-analytics-box-view-custom-params");if(!t)return{};let r={};try{r=JSON.parse(decodeURIComponent(t))}catch(n){console.log(n)}return r})(t)),this.sendBoxViewEvent({contextNode:t,value:r,customParams:s})}sendPageViewProxy(){this.sendPerformanceMetrics(),this.cookieMonsterClient.sendPageView(this.defaultCustomParams.pv),this.cookieMonsterClient.updateReferrer()}sendEventProxy(e,t,r,n,s){return e.nodeType===Node.ELEMENT_NODE?this.sendEvent({value:r,label:s,action:t,contextNode:e,customParams:n}):this.sendEvent(e)}sendItemViewEventProxy({contextNode:e,label:t,value:r,customParams:n}){this.sendItemViewEvent({contextNode:e,label:t,value:r,customParams:q({contextNode:e,customParams:n})})}sendClickEventProxy({contextNode:e,label:t,value:r,customParams:n,destinationUrl:s,isNewTab:i}){if(i&&"boolean"!=typeof i)throw Error("isNewTab property must be boolean");this.sendClickEvent({contextNode:e,label:t,value:r,customParams:z({contextNode:e,destinationUrl:s,customParams:n,isNewTab:i})})}sendContextmenuEventProxy({contextNode:e,label:t,value:r,customParams:n,destinationUrl:s}){this.sendContextmenuEvent({contextNode:e,label:t,value:r,customParams:z({contextNode:e,destinationUrl:s,customParams:n})})}sendBoxInteractionEventProxy({contextNode:e,label:t,value:r,customParams:n}){this.sendBoxInteractionEvent({contextNode:e,label:t,value:r,customParams:F({contextNode:e,customParams:n})})}updateCustomParams({pv:e={},ev:t={}}){i(e)&&i(t)?this.defaultCustomParams={pv:e,ev:t}:console.log("Can not update custom params with non-object arguments!")}registerEventCallback(e){e&&!this.eventCallbacks.includes(e)&&this.eventCallbacks.push(e)}createAPI(){return{sendPageView:this.sendPageViewProxy.bind(this),sendEvent:this.sendEventProxy.bind(this),sendItemViewEvent:this.sendItemViewEventProxy.bind(this),sendClickEvent:this.sendClickEventProxy.bind(this),sendContextmenuEvent:this.sendContextmenuEventProxy.bind(this),sendBoxInteractionEvent:this.sendBoxInteractionEventProxy.bind(this),registerEventCallback:this.registerEventCallback.bind(this)}}}function Y(e){return!i(e)||"clientImplementationVersion"in e?e:Object.assign(e,{clientImplementationVersion:""})}function G({instance:e,method:t,reportError:r,data:n=null,onSuccess:s=(()=>{})}){if(e&&c(e[t]))try{e[t](n),s()}catch(i){r(i)}}function Q(e,t){return""===t?e:`${e}@${t}`}class K{constructor({targetWindow:e,services:t,reportError:r,unmountNodeCallback:n,mountNodeCallback:s}={}){this.targetWindow=e,this.services=t,this.implementations=new Map,this.instances=new Map,this.reportError=r,this.unmountNodeCallback=n,this.mountNodeCallback=s}unmountNode(e){this.unmountNodeCallback(e),h(e,"[data-prototype-id]").concat([e]).forEach(e=>{const t=e.getAttribute("data-box-id")||e.getAttribute("data-box-name");G({instance:this.instances.get(t),method:"onUnmount",reportError:this.reportError}),this.instances.set(t,null)})}mountNode(e){h(e,"[data-prototype-id]").concat([e]).forEach(e=>{const t=e.getAttribute("data-prototype-id"),r=e.getAttribute("data-civ")||"";this.registerInstancesForPrototype(t,r,[e])}),this.mountNodeCallback(e)}isPrototypeObjectValid(e){const{prototypeName:t,clientImplementationVersion:r}=e;return"prototypeName"in e?""===t?(this.reportError(Error('Property "prototypeName" cannot be empty string')),!1):o(t)?!!o(r)||(this.reportError(Error(`Property "clientImplementationVersion" must be string but got ${typeof r}`)),!1):(this.reportError(Error(`Property "prototypeName" must be string but got ${typeof t}`)),!1):(this.reportError(Error('Property "handledPrototype" must have "prototypeName" field')),!1)}containsValidPrototypes(e){return 0===e.length?(this.reportError(Error("Empty handledPrototypes list")),!1):!e.filter(e=>!this.isPrototypeObjectValid(e)).length}isPrototypeValid(e){return s(e)?this.containsValidPrototypes(e):i(e)?this.isPrototypeObjectValid(e):(this.reportError(Error('"handledPrototype" argument must be an object or an array')),!1)}isImplementationValid(e){return c(e)?e.prototype.onUpdate&&!c(e.prototype.onUpdate)?(this.reportError(Error(`"onUpdate" property must be a function or undefined but got ${typeof e.prototype.onUpdate}`)),!1):!!c(e.prototype.onMount)||(this.reportError(Error('"implementation" class has to have "onMount" method')),!1):(this.reportError(Error('"implementation" must be a class')),!1)}registerInstancesForPrototype(e,t,r){const n=this.implementations.get(Q(e,t));n&&this.registerInstances(r,this.services.getServicesForComponent(e),n)}registerImplementationAndInstances({prototypeName:e,clientImplementationVersion:t},r){const n=Q(e,t),s=""===t;this.implementations.has(n)?this.reportError(Error(`${e} ${s?"":`with ${t} client implementation version `}already registered!`)):(this.implementations.set(n,r),this.registerInstancesForPrototype(e,t,h(this.targetWindow.document,`[data-prototype-id="${e}"]${s?"":`[data-civ="${t}"]`}`)))}updateComponentCallback(e,t){G({instance:this.instances.get(e),method:"onUpdate",reportError:this.reportError,data:t})}beforeUpdateComponentCallback(){this.instances.forEach(e=>G({instance:e,method:"beforeOnUpdate",reportError:this.reportError}))}getSerializedPropsFromNode(e){if(!e)return{};try{return JSON.parse(e.textContent)}catch(t){return this.reportError(t),{}}}getSerializedPropsForBox(e,t){const r=[e?`[data-serialize-box-id="${e}"]`:null,t?`[data-serialize-box-name="${t}"]`:null].filter(Boolean).join(", "),n=this.targetWindow.document.querySelector(r);return n?this.getSerializedPropsFromNode(n):{}}registerInstances(e,t,r){e.forEach(e=>{if(e.getAttribute("data-pathname"))return;const n=e.getAttribute("data-box-name"),s=e.getAttribute("data-box-id"),i=this.getSerializedPropsForBox(s,n),o=new r({baseNode:e,props:i,services:t}),a=s||n;G({instance:o,method:"onMount",reportError:this.reportError,onSuccess:()=>{this.instances.set(a,o)}})})}register(e,t){const r=(e=>s(e)?e.map(Y):Y(e))(e);this.isPrototypeValid(r)&&this.isImplementationValid(t)&&(s(r)?r.forEach(e=>{this.registerImplementationAndInstances(e,t)}):this.registerImplementationAndInstances(r,t))}createPublicAPI(){return{register:this.register.bind(this)}}createPrivateAPI(){return{updateComponentCallback:this.updateComponentCallback.bind(this),beforeUpdateComponentCallback:this.beforeUpdateComponentCallback.bind(this),unmountNode:this.unmountNode.bind(this),mountNode:this.mountNode.bind(this)}}}const Z=()=>Promise.reject(Error("missing edge host"));class ee{constructor({httpClient:e,edgeHost:t,language:r}){this.edgeHost=t,this.httpClient=e,this.defaultRequestSettings={headers:{"Content-type":"application/vnd.allegro.public.v1+json",Accept:"application/vnd.allegro.public.v1+json","Accept-Language":r}}}prepareRequestSettings(e={}){if(e.disableDefaultHeaders)return e;const t=this.normalizeSettings(e);return M({},this.defaultRequestSettings,t)}normalizeSettings(e){if(!e||!e.headers)return e;const t=function e(t,r){return Object.keys(t).reduce((n,s)=>{const i=t[s],o="object"==typeof i?e(i,r):i;return n[r.find(e=>s.toLowerCase()===e.toLowerCase())||s]=o,n},{})}(e.headers,Object.keys(this.defaultRequestSettings.headers));return n(e,{headers:t})}prepareRequestUrl(e){return this.edgeHost+e}get(e,t){return this.httpClient.get(this.prepareRequestUrl(e),this.prepareRequestSettings(t))}put(e,t,r){return this.httpClient.put(this.prepareRequestUrl(e),t,this.prepareRequestSettings(r))}post(e,t,r){return this.httpClient.post(this.prepareRequestUrl(e),t,this.prepareRequestSettings(r))}patch(e,t,r){return this.httpClient.patch(this.prepareRequestUrl(e),t,this.prepareRequestSettings(r))}delete(e,t){return this.httpClient.delete(this.prepareRequestUrl(e),this.prepareRequestSettings(t))}createAPI(){return this.edgeHost?{get:this.get.bind(this),put:this.put.bind(this),post:this.post.bind(this),patch:this.patch.bind(this),delete:this.delete.bind(this)}:{get:Z,put:Z,post:Z,patch:Z,delete:Z}}}class te{constructor({targetWindow:e,alias:t="cm",config:r={},isExternal:n=!1}){const{cookieMonster:{host:s,account:i,defaultCustomParams:o={},referrer:a=document.referrer}}=r;this.targetWindow=e,this.document=this.targetWindow.document,this.alias=t,this.host=s,this.account=i,this.isExternal=n,this.defaultCustomParams=o,this.referrer=a}initialize(){if(this.isExternal)return this.loadExternal(),void this.callCookieMonster.call(this,"create",this.account);this.host&&this.account&&!this.isLoaded()?(this.load(),this.callCookieMonster.call(this,"create",this.account),this.sendPageView(),this.updateReferrer()):this.updateReferrer()}load(){this.isLoaded()||((e,t,r,n,s)=>{e["cm.analytics.object"]=s,e[s]=e[s]||((...t)=>{(e[s].q=e[s].q||[]).push(t)});const i=u(t,"script",{src:n}),o=t.getElementsByTagName("script")[0];o.parentNode.insertBefore(i,o)})(this.targetWindow,this.document,0,this.host,this.alias)}loadExternal(){this.isLoaded()||((e,t)=>{e["cm.analytics.object"]=t,e[t]=e[t]||((...r)=>{(e[t].q=e[t].q||[]).push(r)})})(this.targetWindow,this.alias)}send(...e){this.callCookieMonster.call(this,this.sendCommand(),...e)}sendPageView(e=this.defaultCustomParams.pv||{}){this.send("pageview",{customParams:e,referrer:this.referrer})}updateReferrer(){this.referrer=window.location.href}callCookieMonster(...e){this.isLoaded()&&this.targetWindow[this.alias].apply(null,e)}isLoaded(){return"function"==typeof this.targetWindow[this.alias]}sendCommand(){return`send@${this.account}`}}const{SEEN_ATTRIBUTE_NAME:re,VISIBLE_FOR_ATTRIBUTE_NAME:ne,BOX_VIEW_ENABLED_ATTRIBUTE_NAME:se,getBoxViewEnabledNodes:ie,getAllBoxViewEnabledNodes:oe,getElementVisibleDimensionLength:ae,getUserViewport:ce}=U;class le{constructor({targetWindow:e,boxes:t=[],significantElementSizePercentage:r=.75,timeoutValue:n=500,debounceTimeoutValue:s=20}){this.targetWindow=e,this.config={timeoutValue:n,debounceTimeoutValue:s,significantElementSizePercentage:r},this.resetState(),this.boxes=t.length?t:ie(e.document),this.visibleElements=[],this.scrollHandlerWithContext=this.scrollHandler.bind(this),this.scrollEndHandler=b(this.resetCurrentlyVisibleElementsAfterScroll,this.config.debounceTimeoutValue),this.resizeEndHandler=b(this.resizeHandler.bind(this),this.config.debounceTimeoutValue),this.resetCurrentlyVisibleElementsOnTimeout=function(e,t,r){let n;return function(...r){const s=this;return new Promise(i=>{clearTimeout(n),n=setTimeout(()=>{n=null,i(e.apply(s,r))},t)})}}(this.resetCurrentlyVisibleElements.bind(this),this.config.debounceTimeoutValue),this.markCurrentlyVisibleElementsAsSeenOnTimeout=b(this.markCurrentlyVisibleElementsAsSeen.bind(this),this.config.timeoutValue)}setUserViewport(){this.state.userViewport=ce(this.targetWindow)}resetState(){const e=(new Date).getTime();this.state={isScrolling:!1,scrollStartTime:e,counterStartTime:e,userViewport:ce(this.targetWindow)}}createEvent(e){let t;try{t=this.targetWindow.document.createEvent("CustomEvent"),t.initCustomEvent(e,!0,!0,{})}catch(r){t=new CustomEvent(e,{cancelable:!0,bubbles:!0})}return t}isSignificantPartOfElementVisible(e){const t=e.right-e.left,r=e.bottom-e.top,n=ae(e.left,e.right,this.state.userViewport.width,t);return ae(e.top,e.bottom,this.state.userViewport.height,r)*n/(t*r)>this.config.significantElementSizePercentage}putVisibleElementsToBuffer(){let e=!1;const t=this.visibleElements.slice();this.visibleElements=[];for(let n=0;n<this.boxes.length;n+=1){let s=null;try{s=this.boxes[n].getBoundingClientRect()}catch(r){e=!0,this.boxes[n]=null}s&&(this.isSignificantPartOfElementVisible(s)?(this.visibleElements.push(this.boxes[n]),-1===t.indexOf(this.boxes[n])&&this.boxes[n].dispatchEvent(this.createEvent("inViewport"))):-1!==t.indexOf(this.boxes[n])&&this.boxes[n].dispatchEvent(this.createEvent("outOfViewport")))}e&&(this.boxes=this.boxes.filter(e=>null!==e),ie(this.targetWindow.document).forEach(this.addBox.bind(this)))}markElementAsSeen(e,t){if(!e)return;const r=parseInt(e.getAttribute(ne),10)||0;(!e.getAttribute(re)&&r+t)>=this.config.timeoutValue&&(e.setAttribute(re,!0),e.dispatchEvent(this.createEvent("boxView"))),e.setAttribute(ne,r+t)}markPreviouslyVisibleElementsAsSeen(){const e=(new Date).getTime();this.visibleElements.forEach(t=>{this.markElementAsSeen(t,e-this.state.counterStartTime)})}markPreviouslyVisibleElementsAsSeenAfterScroll(){this.visibleElements.forEach(e=>{this.markElementAsSeen(e,this.state.scrollStartTime-this.state.counterStartTime)})}markCurrentlyVisibleElementsAsSeen(){this.visibleElements.forEach(e=>{this.markElementAsSeen(e,this.config.timeoutValue)})}resetCurrentlyVisibleElements(){this.markPreviouslyVisibleElementsAsSeen(),this.putVisibleElementsToBuffer(),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}resetCurrentlyVisibleElementsAfterScroll(){this.markPreviouslyVisibleElementsAsSeenAfterScroll(),this.putVisibleElementsToBuffer(),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}scrollHandler(){this.state.isScrolling||(this.state.scrollStartTime=(new Date).getTime(),this.state.isScrolling=!0),clearTimeout(this.markCurrentlyVisibleElementsAsSeenOnTimeout()),this.scrollEndHandler()}resizeHandler(){this.setUserViewport(),this.resetCurrentlyVisibleElements()}addBox(e){-1===this.boxes.indexOf(e)&&this.boxes.push(e)}isBoxInViewport(e){return-1!==this.visibleElements.indexOf(e)}clearAttributes(e){this.boxes.forEach(t=>{t&&t.matches(e)&&(t.removeAttribute(re),t.removeAttribute(ne))})}markBoxAsRendered(e,t=""){return t&&this.clearAttributes(t),e.getAttribute(se)&&this.addBox(e),ie(e).forEach(this.addBox.bind(this)),this.resetCurrentlyVisibleElementsOnTimeout()}markBoxAsVisible(e,t=!1){this.addBox(e),t?this.markElementAsSeen(e,this.config.timeoutValue):this.resetCurrentlyVisibleElementsOnTimeout()}recursivelyMarkBoxAsVisible(e,t=!1){this.markBoxAsVisible(e,t),j(e).forEach(e=>this.markBoxAsVisible(e,t))}removeBox(e){this.boxes=this.boxes.filter(t=>t!==e),this.visibleElements=this.visibleElements.filter(t=>t!==e)}markBoxAsHidden(e){this.removeBox(e),this.resetCurrentlyVisibleElementsOnTimeout()}unmountNode(e){oe(e).forEach(e=>this.removeBox(e))}recursivelyMarkBoxAsHidden(e){this.markBoxAsHidden(e),j(e).forEach(e=>this.markBoxAsHidden(e))}trackBoxScroll(e){e.addEventListener("scroll",this.scrollHandlerWithContext)}initialize(){this.targetWindow.addEventListener("scroll",this.scrollHandlerWithContext),this.targetWindow.addEventListener("resize",this.resizeEndHandler),this.resetCurrentlyVisibleElements()}createAPI(){return{markBoxAsRendered:this.markBoxAsRendered.bind(this),markBoxAsVisible:this.markBoxAsVisible.bind(this),recursivelyMarkBoxAsVisible:this.recursivelyMarkBoxAsVisible.bind(this),markBoxAsHidden:this.markBoxAsHidden.bind(this),recursivelyMarkBoxAsHidden:this.recursivelyMarkBoxAsHidden.bind(this),trackBoxScroll:this.trackBoxScroll.bind(this),isBoxInViewport:this.isBoxInViewport.bind(this)}}}var de=e=>t=>{0===t.status||(e.newrelic?(console.error(`Reporting error to newrelic: ${t.message}`),e.newrelic.noticeError(t)):console.error(`Error: ${t.message}`))};const he=e=>{const{origin:t,pathname:r,search:n}=e;return`${t}${r}${n}`};class ue{constructor({targetWindow:e,opboxWebClient:t,rawDataListenersRegistry:r}){this.targetWindow=e,this.opboxWebClient=t,this.rawDataListenersRegistry=r,this.history=[e.location.pathname],this.recentlyFetchedURL=he(e.location)}initialize(){this.targetWindow.onpopstate=e=>this.handlePopState(e),this.targetWindow.history.replaceState({opboxjs:!0},"")}isInternalNavigation(e){return this.history.find(t=>t===e)}navigateRelative(e){const{pathname:t,search:r}=this.targetWindow.location,n=t+r,s=t+((e,t)=>{function r(e){const t=/([^&=]+)=?([^&]*)/g,r={},n=e.substring(e.indexOf("?")+1,e.length);let s;for(;s=t.exec(n);)i=r,o=decodeURIComponent(s[1]),a=decodeURIComponent("string"===s[1]?s[2].replace(/\+/g," "):s[2]),void 0===i[o]?i[o]=[a]:i[o].push(a);var i,o,a;return r}const n=r(e);let s;const i=((e,t)=>{for(let r=0,{length:n}=e;r<n;r+=1)if("route"===e[r].name)return e[r];return null})(n);function o(e){t.forEach(t=>{return r=e,n=t.name,s=t.value,void(r[n]=Array.isArray(s)?s:[s]);var r,n,s})}function a(e){return Object.keys(e).map(t=>e[t].map(e=>[t,e])).reduce(f,[]).reduce((e,[t,r])=>null!=r?`${e}${(e?"&":"?")+encodeURIComponent(t)}=${encodeURIComponent(r)}`:e,"")}return i&&0===i.value.indexOf("http")?(s=2===i.value.split("?").length?r(i.value.split("?")[1]):[],o(s),i.value=i.value.split("?")[0]+a(s)):o(n),a(n)})(r,e);return this.changeUrl(s),this.history.push(t),this.targetWindow.performance.mark("clientSideNavigationStart"),s!==n&&this.fetch(s),s}refreshPage(){const{pathname:e,search:t}=this.targetWindow.location,r=e+t;this.fetch(r)}changeUrl(e){return this.targetWindow.history.pushState("","",e)}handlePopState(e){const{pathname:t}=e.target.location,r=he(e.target.location);this.isInternalNavigation(t)&&this.recentlyFetchedURL!==r&&this.refreshPage()}fetch(e){this.recentlyFetchedURL=he(this.targetWindow.location),this.rawDataListenersRegistry.triggerProgressListener(),this.opboxWebClient.getPageData(e).then(e=>this.rawDataListenersRegistry.triggerChangeListener(e)).catch(de)}}const me="opboxAnimationTimerInterval";function pe(e,t,r,n,{duration:s=500,onFinish:i}={}){if("function"!=typeof n)return null;const o=(e=>e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||(e=>{setTimeout(e,1e3/60)}))(e),a=Date.now(),c=r-t;let l=!1;const d=()=>{const e=Date.now()-a;if(l||e>=s)"function"==typeof i&&i(),l=!1;else{const i=((r=Math.min(e/s,1))<.5?8*r*r*r*r:1-8*--r*r*r*r)*c+t;n(i),o(d)}var r};return d(),{stop(){l=!0}}}function ge(e,t=0,{duration:r=500}={}){const n=e.pageYOffset,s=Math.max(0,t),i=e.document.body.scrollHeight;function o(){e[me]&&"function"==typeof e[me].stop&&(e[me].stop(),e[me]=null)}o(),e[me]=pe(e,n,t,t=>{e.scrollTo(0,Math.round(t)),(t=>{const r=t===s||t===s,n=e.innerHeight+t>=i;return r||n})(t)&&o()},{duration:r})}function be(e,t){return r=>{if(!e.has(r))return Promise.reject(Error(`Service ${r} is not registered`));const n=e.get(r);return n.fetchIfNotFetched(t),n.promise}}class fe{constructor({prototypeName:e,servicesRegistry:t,targetWindow:r}){this.services=new Map,this.targetWindow=r,t.forEach((t,r)=>{t.components.some(t=>t.prototypeName===e)&&this.services.set(r,t)}),this.get=be(this.services,this.targetWindow)}has(e){return this.services.has(e)}}function ve(e,t,{inHead:r=!1,referenceNode:n=null}={}){return s=>{if(l(s))return null;const i=u(e.document,"link",s,{rel:t});if(n)((e,t)=>{e.insertAdjacentElement("beforebegin",t)})(n,i);else{const t=r?"head":"body";e.document[t].appendChild(i)}return i}}var ye=["spinner","button","link","badge","brand","bubble","card","chart","desk","divider","heading","hint","icon","indicator","input","list","timeline","marker","notification","placeholder","price","progress","table","dropdown","breadcrumb","accordion","carousel","chip","choice","dialog","field","image-tile","input-group","message","modal","pagination","range","select","sheet","slider","soap","stepper","tabs","typography","color","grid","calendar","attachment","article","navigation-tiles","pin","player-video","align","border","box-sizing","display","flex","height","margin","padding","position","transition","utils","visibility","white-space","width","zindex","core"],Ee=(e,t,r)=>{const n=ve(e,"stylesheet",{inHead:!0,referenceNode:r})({type:"text/css",href:t});return new Promise((e,t)=>{n.addEventListener("error",t),n.addEventListener("load",e)})};const xe=e=>({href:t})=>-1!==t.indexOf(e);let we;function Ce(e,t){return t.filter(t=>{return!e.find((r=t,e=>r.url?r.url===e.url||r.url===e.href||r.url===e.src:!!r.code&&r.code===e.code));var r})}function Pe(e,t,r){if(!t.length)return Promise.resolve();const n=(e=>h(e,'link[type="text/css"],style',e=>({href:e.href,code:e.innerHTML,node:e,isMetrum:m(e.href)})).filter(({href:e,code:t})=>e||t))(e.document),s=Ce(n,t);we=we&&!we.forceRefresh?we:((e,{metrum:{isBundleEnabled:t,emptyRule:r,bundleUrl:n}})=>{const s=t?((e,t)=>d(e.document.styleSheets).find(({href:e})=>e&&e===t))(e,n):null;let i=[];return{isBundleEnabled:t,inject(n){if(!t)return Promise.resolve();const[o,a]=((e,t)=>t.reduce(([t,r],n)=>(e.includes(n)||r.push(n),t.push(n),[t,r]),[[],[]]))(i,n);return i=o,a.length?((e,t)=>{const r=u(e,"iframe",{style:"display:none"}),n=()=>e.body.removeChild(r);e.body.appendChild(r);const{contentDocument:s,contentWindow:i}=r;return s.open("text/html","replace"),s.write(t.map(C).join("")),s.close(),new Promise(e=>{const r=()=>e([d(s.styleSheets),n]),o=()=>{i.removeEventListener("load",o),r()};"complete"===s.readyState&&s.styleSheets.length===t.length?r():i.addEventListener("load",o)})})(e.document,a).then(([e,t])=>{e.forEach(e=>{if(((e,t)=>t.cssRules.length>0&&d(e.cssRules).findIndex(e=>e.cssText===t.cssRules[0].cssText)>-1)(s,e))return;const t=p(e.href),n=((e,t)=>d(e.cssRules).findIndex(e=>e.selectorText===t))(s,(a=t,r.pattern.replace(r.replacementPart,a))),i=n>0?n:s.cssRules.length,o=d(e.cssRules);var a;for(let r=0;r<o.length;r+=1)s.insertRule(o[r].cssText,i+r)}),t()}):Promise.resolve()}}})(e,r);const{inject:i,isBundleEnabled:o}=we,{metrumStyles:a,injectedStyles:c}=s.reduce((t,r)=>m(r.url)&&o?(t.metrumStyles.push(r.url),t):(t.injectedStyles.push(((e,t,{url:r,code:n})=>m(r)?((e,t,r,n)=>{const s=p(r);return n.includes(s)?Ee(e,r,((e,t,r)=>{const n=e.filter(({isMetrum:e})=>e),s=t.slice(0,t.indexOf(r)).reverse().find(e=>n.find(xe(e))),i=s?n.find(xe(s)).node:null;return!i&&n.length?n[0].node.previousElementSibling:!i&&e.length?e[0].node.previousElementSibling:i})(t,n,s)):Promise.resolve()})(e,t,r,ye):r?Ee(e,r):n?((e,t)=>{const r=u(e.document,"style",{innerHTML:t});return e.document.head.appendChild(r),Promise.resolve()})(e,n):Promise.reject())(e,n,r)),t),{metrumStyles:[],injectedStyles:[]});return c.push(i(a)),Promise.all(c)}function ke(e,t){if(!t.length)return Promise.resolve();const r=(e=>d(e.document.getElementsByTagName("script"),({src:e,innerHTML:t,nonce:r})=>({src:e,code:t,nonce:r})))(e),n=(e=>(e.find(({nonce:e})=>!!e)||{}).nonce)(r),s=Ce(r,t);return Promise.all(s.map(((e,t)=>{const r=de(e),n=(e=>"noModule"in e.document.createElement("script"))(e);return({url:s,code:i,attributes:o,type:a,async:c})=>s||i?new Promise(l=>{const d=!s&&!!i,h="module"===a,m=u(e.document,"script");let p;const g=e=>{l(),e.message||(e.message=`Error while loading script: ${s}`),r(e),m.removeEventListener("error",g)},b=()=>{l(),m.removeEventListener("error",g),m.removeEventListener("load",b)};if(!h||n){if(o){if(o.nomodule&&n)return void l();Object.entries(o).forEach(([t,r])=>{"data-serialize-box-id"!==t&&"data-serialize-box-name"!==t||(p=e.document.querySelector(`[${t}="${r}"]`)),m.setAttribute(t,r)})}t&&m.setAttribute("nonce",t),c&&m.setAttribute("async","async"),a&&(m.type=a),d?(m.innerHTML=i,l()):(m.src=s,m.addEventListener("load",b),m.addEventListener("error",g)),p?p.parentNode.replaceChild(m,p):e.document.body.appendChild(m)}else l()}):Promise.resolve()})(e,n)))}function Se(e,t,r){const{svgColorMatrixFilters:n="",assets:{scripts:s=[],styles:i=[],prefetches:o=[],preloads:a=[]}}=t;return(({document:e},t)=>{if(!t)return;const r=e.querySelector("#svg-color-matrix-filters"),n=u(e,"div",{innerHTML:t}).querySelector("svg");r?h(n,"filter",e=>{r.querySelector(`#${e.getAttribute("id")}`)||r.appendChild(e)}):e.body.insertBefore(n,e.body.firstChild)})(e,n),((e,t)=>{t.forEach(ve(e,"preload"))})(e,a),((e,t)=>{t.forEach(ve(e,"prefetch"))})(e,o),Promise.all([ke(e,s),Pe(e,i,r)])}class Ae{constructor({assetUrl:e,components:t,reportError:r}){this.assetUrl=e,this.components=t,this.reportError=r,this.implementation=null,this.status=0,this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}update(e){this.components=((e,t)=>t.reduce((e,t)=>e.find(({prototypeName:e})=>e===t.prototypeName)?e:e.concat(t),e))(this.components,e)}registerImplementation(e){try{this.implementation=new e,this.status=2,this.resolve(this.implementation)}catch(t){this.handleError(t)}}fetchIfNotFetched(e){0===this.status&&(this.status=1,ke(e,[{url:this.assetUrl}]).catch(e=>{this.handleError(e)}))}handleError(e){this.reportError(e),this.status=2,this.reject()}}class Te{constructor({targetWindow:e,reportError:t}){this.targetWindow=e,this.reportError=t,this.servicesRegistry=new Map;const r=this.targetWindow.document.querySelector('[data-config="services"]');if(r)try{JSON.parse(r.textContent).forEach(([e,{assetUrl:t,components:r}])=>{this.setServiceToRegistry(e,t,r)})}catch(n){this.reportError(n)}this.dangerouslyGet=be(this.servicesRegistry,this.targetWindow),this.update=this.update.bind(this)}getServicesForComponent(e){return new fe({prototypeName:e,servicesRegistry:this.servicesRegistry,targetWindow:this.targetWindow})}setServiceToRegistry(e,t,r){this.servicesRegistry.set(e,new Ae({assetUrl:t,components:r,reportError:this.reportError}))}update(e){e.forEach(([e,{assetUrl:t,components:r}])=>{this.servicesRegistry.has(e)?this.servicesRegistry.get(e).update(r):this.setServiceToRegistry(e,t,r)})}register({serviceName:e},t){this.servicesRegistry.get(e).registerImplementation(t)}createAPI(){return{register:this.register.bind(this),__dangerouslyGet__:this.dangerouslyGet.bind(this)}}}const Ne=()=>Date.now();class Ie{constructor({localStorage:e,reportError:t,ttlMs:r=2592e6,key:n="opbox.preferences",timeProvider:s=Ne}){this.writeToStorage=this.writeToStorage.bind(this),this.loadPreferences=this.loadPreferences.bind(this),this.cleanupPreferences=this.cleanupPreferences.bind(this),this.savePreferences=this.savePreferences.bind(this),this.storage=(e=>{try{const t="test_preferences_storage";return e.setItem(t,t),e.getItem(t),e.removeItem(t),!0}catch(t){return!1}})(e)?e:{setItem(){},getItem(){return{}}},this.ttlMs=r,this.key=n,this.timeProvider=s,this.reportError=t}savePreferences(e){const t=this.loadPreferences(),r=this.timeProvider(),n=e.reduce(E(({name:e,value:t})=>({[e]:{value:t,timestamp:r}})),t);this.writeToStorage(n)}writeToStorage(e){try{this.storage.setItem(this.key,JSON.stringify(e))}catch(t){this.reportError(t)}}loadPreferences(){try{return JSON.parse(this.storage.getItem(this.key))||{}}catch(e){return this.reportError(e),{}}}cleanupPreferences(){const e=this.loadPreferences(),t=this.timeProvider(),r=Object.entries(e).reduce(E(([e,r])=>r.timestamp+this.ttlMs>t?{[e]:r}:{}),{});this.writeToStorage(r)}}const Ve={withCredentials:!0,headers:{"Content-type":"application/vnd.allegro.internal.v1+json",Accept:"application/vnd.allegro.internal.v1+json"}};class Re{constructor({edgeClient:e,localStorage:t,ttlMs:r,reportError:n}){this.edgeClient=e,this.storage=new Ie({localStorage:t,ttlMs:r,reportError:n}),this.setPreference=this.setPreference.bind(this),this.getPreference=this.getPreference.bind(this),this.getPreferences=this.getPreferences.bind(this),this.getPreferencesFromLocalStorageOrDefaults=this.getPreferencesFromLocalStorageOrDefaults.bind(this)}setPreference(e,t){const r={name:e,value:t};return this.storage.savePreferences([r]),this.edgeClient.post("/preferences",r,Ve)}getPreference(e,t){return"string"==typeof e||e instanceof String?this.getPreferences({[e]:t}).then(t=>t[e]):Promise.reject(Error("illegal argument type provided as preference name"))}getPreferences(e){if("object"!=typeof e)return Promise.reject(Error("illegal argument type provided as preferences"));const t=`/preferences?name=${Object.keys(e).join(",")}`;return this.edgeClient.get(t,Ve).then(e=>(this.storage.savePreferences(e.data.preferences),e.data.preferences.reduce(E(({name:e,value:t})=>({[e]:t})),{}))).catch(()=>this.getPreferencesFromLocalStorageOrDefaults(e))}getPreferencesFromLocalStorageOrDefaults(e){this.storage.cleanupPreferences();const t=this.storage.loadPreferences();return Object.entries(e).reduce(E(([e,r])=>({[e]:e in t?t[e].value:r})),{})}createAPI(){return{set:this.setPreference,get:this.getPreference,getMany:this.getPreferences}}}var Oe=({config:e,targetWindow:t,unmountNodeCallback:r,mountNodeCallback:n,updateServicesCallback:s,injectAssets:i=Se})=>{function o(e){return t.document.querySelector(`[data-box-id="${e}"]`)}return({boxId:a,data:c,isPlaceholder:l})=>{const{htmlString:d,servicesConfig:h}=c;return s(h),i(t,c,e).then(()=>{const e=l?(e=>t.document.querySelector(`[data-placeholder-for="${e}"]`))(a):o(a);if(r(e),!d)return void e.parentNode.removeChild(e);const s=u(t.document,"div",{innerHTML:d});e.parentNode.replaceChild(s.firstElementChild,e),n(o(a))})}},Be=({config:e,targetWindow:t,unmountNodeCallback:r,mountNodeCallback:n,updateServicesCallback:s,injectAssets:i=Se})=>{function o(e,r){const n=u(t.document,"div",{innerHTML:r});return n.setAttribute("data-pathname",e),n}return({pathname:a,data:c})=>{const{htmlString:l,servicesConfig:d}=c;return s(d),i(t,c,e).then(()=>{const e=(e=>t.document.querySelector(`[data-pathname="${e}"]`))(a);if(!e&&l){const e=o(a,l);return t.document.body.appendChild(e),void n(e)}if(e){if(r(e),!l)return void e.parentNode.removeChild(e);const t=o(a,l);e.parentNode.replaceChild(t,e),n(t)}})}};const We=new class{constructor(e,t,r){this.targetWindow=e;const n=(e=>P(e).config)(this.targetWindow),s=new k({targetWindow:e}),i=new te({targetWindow:e,config:n}),o=new le({targetWindow:e}),a=new X({targetWindow:e,config:n,cookieMonsterClient:i,boxViewsMarker:o,sendPerformanceMetrics:this.sendPerformanceMetrics.bind(this)}),c=de(e),l=new Te({targetWindow:e,reportError:c}),d=(e=>{const t=new K(e);return{public:Object.assign({init:(r=e.targetWindow,({prototypeName:e},t)=>{e&&t({domNodes:h(r.document,`[data-prototype-id="${e}"]`)})})},t.createPublicAPI()),private:t.createPrivateAPI()};var r})({targetWindow:e,services:l,reportError:c,unmountNodeCallback:o.unmountNode.bind(o),mountNodeCallback:o.markBoxAsRendered.bind(o)}),u=new B({appContext:s,analytics:a,updateComponentCallback:d.private.updateComponentCallback,beforeUpdateComponentCallback:d.private.beforeUpdateComponentCallback}),m={config:n,targetWindow:e,unmountNodeCallback:d.private.unmountNode,mountNodeCallback:d.private.mountNode,updateServicesCallback:l.update},p=new R({httpClient:t,reportError:c,fragmentRenderCallback:Be(m),boxRenderCallback:Oe(m)});this.config=n,this.cookieMonsterClient=i,this.boxViewsMarker=o,this.analytics=a,this.services=l,this.componentAPI=d,this.rawDataListenersRegistry=u,this.opboxWebClient=p,this.reportError=c,this.navigation=new ue({targetWindow:e,opboxWebClient:p,rawDataListenersRegistry:u}),this.edgeClient=new ee({httpClient:r,edgeHost:n.edgeHost,language:n.language}),this.edgeUploadClient=new ee({httpClient:r,edgeHost:n.edgeUploadHost,language:n.language}),this.preferencesClient=new Re({edgeClient:this.edgeClient,localStorage:this.targetWindow.localStorage,reportError:this.reportError}),this.uiTools=(e=>{const t=t=>"string"!=typeof t?null:e.document.querySelector(`a[name="${t}"]`),r=t=>{const r=e.pageYOffset||e.document.documentElement.scrollTop||0;return t?t.getBoundingClientRect().top+r:null};return{getBoxAnchorNode:t,getTopOffset:r,scrollTo(n,{animate:s=!0}={}){const i={duration:s?500:0};if("number"==typeof n)return void ge(e,n,i);const o=t(n);if(o){const t=r(o);ge(e,t,i)}},tween(...t){return pe(e,...t)}}})(e),this.analytics.initialize(),this.navigation.initialize(),this.boxViewsMarker.initialize()}get API(){return{analytics:this.analytics.createAPI(),boxViewsMarker:this.boxViewsMarker.createAPI(),component:this.componentAPI.public,onData:this.rawDataListenersRegistry.registerListener.bind(this.rawDataListenersRegistry),changeParams:this.navigation.navigateRelative.bind(this.navigation),refreshPage:this.navigation.refreshPage.bind(this.navigation),tween:this.uiTools.tween,scrollTo:this.uiTools.scrollTo,page:this.opboxWebClient.createAPI(),edge:this.edgeClient.createAPI(),edgeUpload:this.edgeUploadClient.createAPI(),preferences:this.preferencesClient.createAPI(),onDomReady:this.domReadyHelper.bind(this),loaded:!0,performance:P(this.targetWindow).performance,services:this.services.createAPI(),reportError:this.reportError}}domReadyHelper(e){"loading"===this.targetWindow.document.readyState?this.targetWindow.document.addEventListener("DOMContentLoaded",e):this.targetWindow.setTimeout(e,0)}lazyloadedElement({target:e}={}){const t=e.getAttribute("data-placeholder-for");t&&this.opboxWebClient.render.box({boxId:t,isPlaceholder:!0})}renderBoxForLazyloadedPlaceholders(){Array.from(this.targetWindow.document.querySelectorAll("[data-placeholder-for].lazyloaded"),e=>{const t=e.getAttribute("data-placeholder-for");return this.opboxWebClient.render.box({boxId:t,isPlaceholder:!0})})}broadcastAPILoadEvent(){const e=((e,t)=>{const r=this.targetWindow.document.createEvent("CustomEvent");return r.initCustomEvent("opboxAPILoaded",!0,!0,{}),r})();this.targetWindow.dispatchEvent(e)}attach(){const e=P(this.targetWindow),t=this.API;var r,s;e&&(function e(t,r,n,...s){if(c(t)&&c(r)){if(!t.__queue__)return;o=t.__queue__,a=r,o.forEach(({args:e,reject:t,resolve:r})=>{const n=((e,t)=>{try{return e(...t)}catch(r){return void console.error(r)}})(a,e);n&&c(n.then)&&c(r)&&c(t)&&n.then(r,t)}),n(r,...s)}else i(t)&&i(r)&&Object.keys(t).forEach(i=>{e(t[i],r[i],n,...s.concat(i))});var o,a}(e,t,(t,...r)=>{return s=this.targetWindow,i=function e(t,r,...n){if(0===n.length)return r;const s=n,i=s.shift();return(t="object"!=typeof t?{}:t)[i]=e(t[i],r,...s),t}(e,t,...r),s.opbox=s.opbox||{},void n(s.opbox,i);var s,i}),r=e,s=Object.keys(t).concat("initialized","config"),Object.keys(r).forEach(e=>{s.includes(e)||delete r[e]}),Object.freeze(e)),(({navigator:{serviceWorker:e},location:{href:t}},r)=>{e&&(((e,t,r)=>{"function"==typeof e.addEventListener&&e.addEventListener("message",e=>{"installed"===e.data&&t("event","PWA","serviceworker-registered",null,r)})})(e,r,t),((e,t)=>{if("function"!=typeof e.getRegistrations)return Promise.resolve();const r=e=>e.unregister().then(t=>t?e.active.scriptURL:"");e.getRegistrations().then(e=>Promise.all(e.map(r))).then(e=>{const r=e.filter(Boolean);r.length>0&&t("event","PWA","serviceworker-unregistered",null,r.join(","))})})(e,r))})(this.targetWindow,this.cookieMonsterClient.send.bind(this.cookieMonsterClient)),this.broadcastAPILoadEvent(),this.targetWindow.addEventListener("lazyloaded",this.lazyloadedElement.bind(this)),t.performance.markTimeToInteractive("opbox-web-browser")}sendPerformanceMetrics(){this.targetWindow.pinter&&this.targetWindow.pinter.sendUserTimings&&this.targetWindow.pinter.sendUserTimings()}run(){this.attach(),this.renderBoxForLazyloadedPlaceholders()}}(window,r(),r());We.run(),We.attach.bind(We);