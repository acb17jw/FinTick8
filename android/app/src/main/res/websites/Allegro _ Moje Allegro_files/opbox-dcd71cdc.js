var attach=function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function u(e,t,n){return(u=c()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&s(i,n.prototype),i}).apply(null,arguments)}function l(e){var t="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return u(e,arguments,a(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function f(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var v=function(e,n,r,i,o,a){var s=new XMLHttpRequest;return s.open(e,n,!0),Object.keys(i).forEach((function(e){s.setRequestHeader(e,i[e])})),s.withCredentials=o,s.upload&&a&&s.upload.addEventListener("progress",a),s.send(function(e,n){return["POST","PUT","PATCH"].includes(e)?"object"!==t(n)||n instanceof Blob||n instanceof FormData?n:JSON.stringify(n):null}(e,r)),s},m=function(e){return e>=200&&e<=204},p=function(e,t,n,r){var i=e.status,o=e.responseText,a=t(i),s=function(e){return e.split("\n").reduce((function(e,t){var n=t.indexOf(":"),r=t.substr(0,n).trim().toLowerCase(),i=t.substr(n+1).trim();return r&&(e[r]=e[r]?"".concat(e[r],", ").concat(i):i),e}),{})}(e.getAllResponseHeaders()),c={};try{c=JSON.parse(o)}catch(e){c=o}a?n({status:i,data:c,headers:s}):r({status:i,data:c,message:"Request failed with status code ".concat(i),headers:s})},g=function(){var e=null,t=function(t,n,r,i){var o=i.headers,a=void 0===o?{}:o,s=i.validateStatus,c=void 0===s?m:s,u=i.withCredentials,l=void 0!==u&&u,d=i.cancelLast,h=void 0!==d&&d,f=i.onUploadProgress;h&&null!==e&&e.abort();var g=v(t,n,r,a,l,f);return e=g,function(e,t){return new Promise((function(n,r){e.readyState===XMLHttpRequest.DONE?p(e,t,n,r):e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(p(e,t,n,r),e.onreadystatechange=null)}}))}(g,c)};return{request:t,get:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t("GET",e,{},n)},post:function(e,n,r){return t("POST",e,n,r)},put:function(e,n,r){return t("PUT",e,n,r)},patch:function(e,n,r){return t("PATCH",e,n,r)},delete:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t("DELETE",e,{},n)}}};var b=Object.assign;function y(e){return Array.isArray(e)}function k(e){return"object"===t(e)&&!y(e)&&null!==e}function E(e){return"string"==typeof e}function w(e){return void 0===e}function x(e){return"function"==typeof e}function C(e){return null===e||"object"!==t(e)||0===Object.keys(e).length}function P(e,t){return Array.from(e,t)}function S(e,t,n){return e?P(e.querySelectorAll(t),n):[]}function A(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return b.apply(void 0,[e.createElement(t)].concat(r))}function T(e,t){return e.insertAdjacentElement("beforebegin",t)}function N(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.includes("/metrum/")}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.split("/metrum/")[1].split("/")[0]}function O(){}function R(e,t,n){var r;return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];var s=this,c=function(){r=null,n||e.apply(s,o)},u=n&&!r;return clearTimeout(r),r=setTimeout(c,t),u&&e.apply(s,o),r}}function V(e,t){return e.concat(t)}function j(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];if(0===i.length)return e=n;var a=i,s=a.shift();return(e="object"!==t(e)?{}:e)[s]=j.apply(void 0,[e[s],n].concat(a)),e}var M=/Version\/[\d.]+.*Safari/,W=/iPhone|iPad|iPod|Android/i;var B=function(e){return function(t,n){return Object.assign({},t,{},e(n))}},L=function(e,t,n){return e.addEventListener(t,n)},U=function(){return(new Date).getTime()};function H(e){return'<link type="text/css" rel="stylesheet" crossorigin="" href="'.concat(e,'"/>')}var D=function(e){return e.opbox||{}},q=function(e,t){e.opbox=e.opbox||{},b(e.opbox,t)},z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.targetWindow;n(this,e),this.targetWindow=r}return i(e,[{key:"document",get:function(){return this.targetWindow.document}}]),e}();var F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(r,e);var t=function(e){function t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}return function(){var n,r=a(e);if(t()){var i=a(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}(r);function r(e){var i;return n(this,r),(i=t.call(this,e)).message=e,i.name="PageRenderingError",i}return r}(l(Error)),_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.data,i=t.headers;n(this,e),this.data=r,this.headers=i}return i(e,[{key:"valid",get:function(){return k(this.data)}}]),e}(),J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this.dataSources=t}return i(e,[{key:"resolve",value:function(e,t){var n=e.value;if("DATA_SOURCE"===e.type){var r=this.dataSources[n];return Object.assign({},r&&r.data&&o({},t,r.data),{},r&&!C(r.metadata)&&o({},"".concat(t,".$meta"),r.metadata))}return o({},t,n)}}]),e}(),X=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.boxes,i=void 0===r?{}:r,o=t.boxNameToIdMap,a=void 0===o?{}:o,s=t.dataSources,c=void 0===s?{}:s,u=t.meta,l=void 0===u?{}:u;n(this,e),this.boxes=i,this.boxNameToIdMap=a,this.dataSources=c,this.meta=l,this.parameterResolver=new J(this.dataSources)}return i(e,[{key:"resolved",get:function(){return{boxes:this.resolvedBoxes,boxNameToIdMap:this.boxNameToIdMap,dataSources:this.dataSources,meta:this.meta}}},{key:"resolvedBoxes",get:function(){var e=this;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r={};return Object.keys(e).forEach((function(i){r[i]=t.call(n,e[i],i,e)})),r}(this.boxes,(function(t){var n=Object.keys(t).reduce((function(n,r){var i=e.parameterResolver.resolve(t[r],r);return b(n,i)}),{});return b(n,e.pageProperties)}))}},{key:"pageProperties",get:function(){var e=this;return Object.keys(this.meta).filter((function(e){return 0===e.indexOf("$page.")})).reduce((function(t,n){return b(t,o({},n,e.meta[n]))}),{})}}]),e}();function Y(e,t){var n=new URLSearchParams(e.search);return Object.entries(t).map((function(e){var t=h(e,2),r=t[0],i=t[1];return Array.isArray(i)?(n.delete(r),i.forEach((function(e){return n.append(r,e)}))):n.set(r,i),n})),n}function G(e){var t=e.href,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URL(t);return r.search=Y(r,n).toString(),r.toString()}function Q(e){return e>=200&&e<300||502===e}function $(e){return!!e.match(new RegExp("^(\\/[a-zA-Z0-9\\-]+)*\\/{0,1}$"))}var K=function(){function e(t){var r=t.targetWindow,i=void 0===r?window:r,o=t.httpClient,a=t.reportError,s=t.fragmentRenderCallback,c=t.boxRenderCallback;n(this,e),this.httpClient=o,this.reportError=a,this.targetWindow=i,this.fragmentRenderCallback=s,this.boxRenderCallback=c,this.render={box:this.renderBox.bind(this),fragment:this.renderFragment.bind(this)}}return i(e,[{key:"getPageData",value:function(e){var t={headers:{Accept:"application/vnd.opbox-web.v2+json"},cancelLast:!0,validateStatus:Q};return this.httpClient.get(e,t).then((function(e){var t=new _(e);if(!t.valid)throw new F("Opbox response is invalid.");return new X(t.data)}))}},{key:"handleError",value:function(e){return this.reportError(new Error(e)),Promise.reject(e)}},{key:"renderSubtree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.boxId,n=e.additionalQueryParameters,r=void 0===n?{}:n,i=e.isPlaceholder,o=void 0!==i&&i;return this.targetWindow.console.warn("Warning: renderSubtree method is deprecated and will be removed soon. Use render.box method instead."),this.renderBox({boxId:t,additionalQueryParameters:r,isPlaceholder:o})}},{key:"renderBox",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.boxId,r=t.additionalQueryParameters,i=void 0===r?{}:r,o=t.isPlaceholder,a=void 0!==o&&o;return n?this.httpClient.get(G(this.targetWindow.location,i),{headers:{Accept:"application/vnd.opbox-web.subtree+json","x-box-id":n},cancelLast:!1,validateStatus:Q}).then((function(t){var r=t.data;return e.boxRenderCallback({boxId:n,data:r,isPlaceholder:a})})):this.handleError("Missing 'boxId' property!")}},{key:"renderFragment",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.pathname,r=t.additionalQueryParameters,i=void 0===r?{}:r;if(!n)return this.handleError("Missing 'pathname' property!");if(!$(n))return this.handleError("Invalid 'pathname' property!");var o=new URL("".concat(this.targetWindow.location.origin).concat(n)),a=o.href;return this.httpClient.get(G({href:a},i),{headers:{Accept:"application/vnd.opbox-web.subtree+json"},cancelLast:!1,validateStatus:Q}).then((function(t){var r=t.data;return e.fragmentRenderCallback({pathname:n,data:r})}))}},{key:"createAPI",value:function(){return{renderSubtree:this.renderSubtree.bind(this),render:this.render}}}]),e}(),Z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.meta,i=void 0===r?{}:r,o=arguments.length>1?arguments[1]:void 0;n(this,e),this.appContext=o,this.meta=i}return i(e,[{key:"updateMetaRobots",value:function(){var e=this.appContext.document.querySelector('head meta[name="robots"]');e&&this.meta&&e.setAttribute("content",[this.meta.noindexCondition?"noindex":"index",this.meta.nofollowCondition?"nofollow":"follow"].join(", "))}},{key:"render",value:function(){this.updateMetaRobots()}}]),e}(),ee=function(){function e(t){var r=t.appContext,i=t.analytics,o=t.updateComponentCallback,a=void 0===o?O:o,s=t.beforeUpdateComponentCallback,c=void 0===s?O:s;n(this,e),this.appContext=r,this.rawData=new X,this.listeners={},this.analytics=i,this.updateComponentCallback=a,this.beforeUpdateComponentCallback=c}return i(e,[{key:"registerListener",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O;if(this.rawData.boxes[e]){var r=this.rawData.resolved.boxes[e];setTimeout((function(){t(r)}),0)}this.listeners[e]={onChange:t,onProgress:n}}},{key:"triggerChangeListener",value:function(e){var t=this;this.rawData=e;var n=this.rawData.resolved,r=n.boxes,i=n.boxNameToIdMap,o=n.meta;Object.entries(r).forEach((function(e){var n=h(e,2),r=n[0],i=n[1];w(i)||t.updateComponentCallback(r,i)})),Object.keys(i).forEach((function(e){var n=r[i[e]];if(!w(n)){var o=t.listeners[e];o&&x(o.onChange)&&setTimeout((function(){return o.onChange(n)}),0)}}));var a=o.defaultCustomParams;this.analytics&&this.analytics.updateCustomParams(a),new Z({meta:o},this.appContext).render()}},{key:"triggerProgressListener",value:function(){var e=this;this.beforeUpdateComponentCallback(),Object.keys(this.listeners).forEach((function(t){var n=e.listeners[t];n&&x(n.onProgress)&&setTimeout((function(){return n.onProgress()}),0)}))}}]),e}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var te=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){e.exports=function(){function e(e){return e instanceof Object&&e.constructor===Object}function t(n,r){var i=n,o=r;e(n)||(i={}),e(r)||(o={});var a=Object.keys(i),s=Object.keys(o),c={};return a.forEach((function(n){-1!==s.indexOf(n)?null===i[n]?c[n]=o[n]:e(i[n])&&e(o[n])?c[n]=t(i[n],o[n]):c[n]=o[n]:c[n]=i[n]})),s.forEach((function(e){-1===a.indexOf(e)&&(c[e]=o[e])})),c}return function(n){var r=n;e(n)||(r={});for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return o.forEach((function(n){e(n)&&(r=t(r,n))})),r}}()})),ne=function(e){return S(e,"[".concat("data-analytics-enabled","]"))},re=function(e){var t=S(e,"[".concat("data-analytics-proxied","]")).reduce((function(e,t){var n=ne(t).filter((function(t){return!e.includes(t)}));return n.length?V(e,n):e}),[]);return ne(e).filter((function(e){return!t.includes(e)}))},ie=function(){function e(t){var r=t.targetWindow,i=t.onCycleComplete;n(this,e),this.window=r,this.document=this.window.document,this.onCycleComplete=i,this.initTimeStamp=U(),this.engagementCycleStartTime=null,this.engagementTime=0,this.maxScrollBottom=this.getScrollBottom(),this.previousInteractionTime=null,this.handleInteraction=this.handleInteraction.bind(this),this.refreshEngagementCycle=this.refreshEngagementCycle.bind(this),L(r.document,"click",this.handleInteraction),L(r.document,"mousemove",this.handleInteraction),L(r.document,"keydown",this.handleInteraction),L(r.document,"scroll",this.handleInteraction),L(r,"beforeunload",this.refreshEngagementCycle),this.startEngagementCycles()}return i(e,[{key:"getTimeSpentOnPage",value:function(){return U()-this.initTimeStamp}},{key:"updateEngagementTime",value:function(e){if(this.previousInteractionTime){var t;if(this.previousInteractionTime<this.engagementCycleStartTime){var n=e-this.engagementCycleStartTime,r=2e3-(this.engagementCycleStartTime-this.previousInteractionTime);t=Math.min(n,r)}else{var i=e-this.previousInteractionTime;t=Math.min(i,2e3)}this.engagementTime+=t}}},{key:"updateMaxScrollBottom",value:function(){var e=this.getScrollBottom();e>this.maxScrollBottom&&(this.maxScrollBottom=e)}},{key:"getScrollBottom",value:function(){var e=this.window;return e.innerHeight+(e.scrollY||this.document.documentElement.scrollTop)}},{key:"getPageHeight",value:function(){var e=this.document,t=e.body,n=e.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight)}},{key:"endCycle",value:function(e){this.updateEngagementTime(e),this.engagementTime>0&&this.onCycleComplete({engagementTime:this.getEngagementTimeWithLimit(),scrollBottom:this.maxScrollBottom,pageHeight:this.getPageHeight()});var t=e-2e3;this.previousInteractionTime<t&&(this.previousInteractionTime=null),this.engagementTime=0,this.engagementCycleStartTime=e,this.maxScrollBottom=this.getScrollBottom()}},{key:"getEngagementTimeWithLimit",value:function(){return Math.min(this.engagementTime,6e3)}},{key:"handleInteraction",value:function(){var e=this.getTimeSpentOnPage();this.updateEngagementTime(e),this.updateMaxScrollBottom(),this.previousInteractionTime=e}},{key:"refreshEngagementCycle",value:function(){this.endCycle(this.getTimeSpentOnPage())}},{key:"startEngagementCycles",value:function(){this.engagementCycleStartTime=this.getTimeSpentOnPage(),setInterval(this.refreshEngagementCycle,6e3)}}]),e}(),oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return e.slice(0,t)},ae=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.targetWindow,i=t.send;n(this,e),this.window=r,this.send=i,this.counter=0}return i(e,[{key:"handleError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.error,n=void 0===t?{}:t,r=n.name,i=n.message,o=n.stack;this.counter<100&&(this.counter+=1,this.send({type:r,message:oe(i,800),stack:oe(o,800)}))}},{key:"initialize",value:function(){L(this.window,"error",this.handleError.bind(this))}}]),e}(),se=function(e,t){for(var n,r={},i=0;i<e.attributes.length;i+=1){var o=e.attributes[i];if(0===o.name.indexOf(t)){var a=o.name.replace(t,"");r[(n=a,n.replace(/^([A-Z])|[\s|_-](\w)/g,(function(e,t,n){return n?n.toUpperCase():t.toLowerCase()})))]=o.value}}return r},ce=function(e){var t=e.contextNode,n=e.customParams,r=void 0===n?{}:n,i=se(t,"data-analytics-view-opbox-custom-"),o=Object.keys(i).length?{_opbox:i}:{};return te(se(t,"data-analytics-view-custom-"),o,r)},ue=function(e){var t=e.contextNode,n=e.coordinates,r=void 0===n?{}:n,i=e.destinationUrl,o=void 0===i?"":i,a=e.customParams,s=void 0===a?{}:a,c=e.isNewTab,u=c?{isNewTab:c}:{},l=Object.assign({},se(t,"data-analytics-click-opbox-custom-"),{destinationUrl:o},u,{},r);return te(se(t,"data-analytics-click-custom-"),{_opbox:l},s)},le=function(e){var t=e.contextNode,n=e.customParams,r=void 0===n?{}:n,i=se(t,"data-analytics-interaction-custom-"),o=se(t,"data-analytics-interaction-opbox-custom-"),a=Object.keys(o).length?{_opbox:o}:{};return te(i,a,r)},de=function(e){var t=e.closest("[".concat("data-analytics-tags","]"));if(!t)return[];var n,r,i,o,a=!!t.closest("[".concat("data-item","]"))?function(e){var t=e&&e.closest("[".concat("data-box-name","][").concat("data-analytics-tags","]"));return t&&t.getAttribute("data-analytics-tags")||""}(t):"",s=t.getAttribute("data-analytics-tags")||"";return n=s,r=a.split(","),i=n.split(","),(o=r.concat(i)).filter((function(e,t){return e&&o.indexOf(e)===t}))},he=function(e){var t=e.closest("[data-analytics-groups]");if(t){var n=decodeURIComponent(t.getAttribute("data-analytics-groups"));try{n=JSON.parse(n)}catch(e){return console.log("JSON.parse error! Can not convert ".concat(n," to JSON.")),[]}return n}return[]};function fe(e,t,n){return e.addEventListener(t,n),{remove:function(){e.removeEventListener(t,n)}}}var ve=function(){function e(t){var r=t.targetWindow,i=t.config,o=t.cookieMonsterClient,a=t.boxViewsMarker,s=t.sendPerformanceMetrics;n(this,e);var c=i.cookieMonster,u=(c=void 0===c?{}:c).boxViewDisabled,l=c.isEngagementMeasuringEnabled,d=c.isErrorReporterEnabled,h=c.defaultCustomParams,f=void 0===h?{}:h;this.targetWindow=r,this.document=this.targetWindow.document,this.boxViewDisabled=u,this.isEngagementMeasuringEnabled=l,this.isErrorReporterEnabled=d,this.cookieMonsterClient=o,this.boxViewsMarker=a,this.defaultCustomParams=f,this.eventCallbacks=[],this.sendPerformanceMetrics=s||O,this.engagementObserver=null,this.errorReporter=new ae({targetWindow:r,send:this.sendErrorEvent.bind(this)});var v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.navigator,n=(t=void 0===t?{}:t).userAgent,r=void 0===n?"":n;return r}(r);this.isMobile=function(e){return!!e.match(W)}(v),this.isSafari=function(e){return!!e.match(M)}(v),this.isFirefox=function(e){return e.toLowerCase().includes("firefox")}(v)}return i(e,[{key:"initialize",value:function(){this.cookieMonsterClient.initialize(),this.isEngagementMeasuringEnabled&&(this.engagementObserver=new ie({targetWindow:this.targetWindow,onCycleComplete:this.sendPingEvent.bind(this)})),this.isErrorReporterEnabled&&this.errorReporter.initialize(),this.eventHandlers=[fe(this.document,"change",this.handleChange.bind(this)),fe(this.document,"click",this.handleClick.bind(this)),fe(this.document,"mousedown",this.handleLinkClick.bind(this)),fe(this.document,"submit",this.handleSubmit.bind(this)),fe(this.document,"contextmenu",this.handleClick.bind(this)),fe(this.document,"boxView",this.handleBoxView.bind(this)),fe(this.targetWindow,"DOMContentLoaded",this.detectAdblock.bind(this))]}},{key:"teardown",value:function(){this.eventHandlers.forEach((function(e){e.remove()}))}},{key:"callEventCallbacks",value:function(e){this.eventCallbacks.length&&this.eventCallbacks.forEach((function(t){return t(e)}))}},{key:"sendEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.contextNode,n=e.action,r=e.label,i=void 0===r?"":r,o=e.value,a=e.customParams,s=void 0===a?{}:a;if(!t||!n)return{};var c=t.closest("[data-analytics-category]").getAttribute("data-analytics-category"),u=t.closest("[data-box-name]").getAttribute("data-box-name"),l=t.closest("[data-box-id]"),d=l&&l.getAttribute("data-box-id"),h=de(t),f=he(t),v=h.length?{analyticsTags:h}:{},m=f.length?{groups:f}:{},p=d?{boxName:u,boxId:d}:{boxName:u},g=Object.assign({},v,{},m,{},p),b=te(Object.assign({},s),{_opbox:g},this.defaultCustomParams.ev),y={category:c,action:n,label:i,value:o,customParams:b};return this.cookieMonsterClient.send("event",y),this.callEventCallbacks(y),y}},{key:"sendPingEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.engagementTime,n=e.scrollBottom,r=e.pageHeight,i={category:"Engagement",label:"ping",customParams:{et:t,sb:n,ph:r}};this.cookieMonsterClient.send("event",i),this.callEventCallbacks(i)}},{key:"sendErrorEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=e.message,r=e.stack,i={category:"BrowserError",label:t,value:n,customParams:{st:r}};this.cookieMonsterClient.send("event",i),this.callEventCallbacks(i)}},{key:"sendClickEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"click"}))}},{key:"sendContextmenuEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"contextmenu"}))}},{key:"sendBoxInteractionEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"boxInteraction"}))}},{key:"sendItemViewEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"itemView"}))}},{key:"sendBoxViewEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"boxView"}))}},{key:"sendFormSubmitEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"submit"}))}},{key:"detectAdblock",value:function(){var e=this,t=A(this.document,"div",{innerHTML:"&nbsp;",className:"adsbox"});this.document.body.appendChild(t),this.targetWindow.setTimeout((function(){var n=0!==t.offsetHeight;e.cookieMonsterClient.send("event",{category:"clearPV",action:n,customParams:e.defaultCustomParams.ev}),e.document.body.removeChild(t)}),100)}},{key:"handleClick",value:function(e){this.handleBoxInteraction(e),this.handleLinkClick(e)}},{key:"handleBoxInteraction",value:function(e){if("function"==typeof e.target.closest){var t=e.target.closest("[data-analytics-interaction]");if(t){var n=le({contextNode:t}),r=t.getAttribute("data-analytics-interaction-label")||"",i=t.getAttribute("data-analytics-interaction-value")||t.textContent.trim();this.sendBoxInteractionEvent({contextNode:t,label:r,value:i,customParams:n})}}}},{key:"shouldHandleBoxInteraction",value:function(e){return"mousedown"===e.type&&!this.isMobile&&(this.isSafari||this.isFirefox)&&"select-one"===e.target.type}},{key:"handleLinkClick",value:function(e){if("function"==typeof e.target.closest)if(this.shouldHandleBoxInteraction(e))this.handleBoxInteraction(e);else{var t=e.target.closest("a");if(t&&t.hasAttribute("data-analytics-clickable")){var n=t.getAttribute("data-analytics-click-label")||"",r=t.getAttribute("data-analytics-click-value")||t.textContent.trim(),i="_blank"===t.getAttribute("target"),o=t.getAttribute("href"),a=e.pageX?{pageX:e.pageX,pageY:e.pageY}:{};"click"!==e.type||0!==e.button?"contextmenu"!==e.type?"mousedown"===e.type&&1===e.button&&this.sendClickEvent({contextNode:t,label:n,value:r,customParams:ue({contextNode:t,coordinates:a,destinationUrl:o,isNewTab:!0})}):this.sendContextmenuEvent({contextNode:t,label:n,value:r,customParams:ue({contextNode:t,coordinates:a,destinationUrl:o})}):this.sendClickEvent({contextNode:t,label:n,value:r,customParams:ue({contextNode:t,coordinates:a,destinationUrl:o,isNewTab:i||e.metaKey||e.ctrlKey})})}}}},{key:"handleChange",value:function(e){var t=e.target;if("select-one"===t.type&&t&&t.hasAttribute("data-analytics-selectable")){var n=t.options[t.selectedIndex].value,r=se(t,"data-analytics-select-custom-");this.sendEvent({contextNode:t,action:"change",value:n,customParams:r})}}},{key:"handleSubmit",value:function(e){var t=e.target;if(t&&"FORM"===t.nodeName&&t.hasAttribute("data-analytics-submittable")){var n=t.getAttribute("action"),r=P(t.elements).filter((function(e){return e.name})).map((function(e){return{name:e.name,value:e.value}})).sort((function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())})).map((function(e){return"".concat(e.name,"=").concat(e.value)})).join("&"),i=(r=r?"?".concat(r):"")?n+r:n;i=encodeURI(i),this.sendFormSubmitEvent({contextNode:t,value:i,label:"submitForm"})}}},{key:"markParentBoxAsVisible",value:function(e){var t=e.parentNode&&e.parentNode.closest("[data-analytics-enabled]");this.boxViewsMarker&&t&&!t.hasAttribute("data-seen")&&this.boxViewsMarker.markBoxAsVisible(t,!0)}},{key:"handleBoxView",value:function(e){var t=e.target;if(t&&t.hasAttribute("data-analytics-enabled")&&(!this.boxViewDisabled||t.hasAttribute("data-item"))&&!P(t.childNodes).some((function(e){return e.classList&&e.classList.contains("opbox-fragment")}))){var n=t.getAttribute("data-analytics-view-value")||"",r=t.getAttribute("data-analytics-view-label")||"",i=ce({contextNode:t});if(t.firstChild&&t.firstChild.nodeType===Node.ELEMENT_NODE&&(i=Object.assign({},i,{},se(t.firstChild,"data-analytics-view-custom-"))),t.hasAttribute("data-item"))return this.markParentBoxAsVisible(t),void this.sendItemViewEvent({contextNode:t,label:r,value:n,customParams:i});i=Object.assign({},i,{},function(e){if(!e)return{};var t=e.getAttribute("data-analytics-box-view-custom-params");if(!t)return{};var n={};try{n=JSON.parse(decodeURIComponent(t))}catch(e){console.log(e)}return n}(t)),this.sendBoxViewEvent({contextNode:t,value:n,customParams:i})}}},{key:"sendPageViewProxy",value:function(){this.sendPerformanceMetrics(),this.cookieMonsterClient.sendPageView(this.defaultCustomParams.pv),this.cookieMonsterClient.updateReferrer()}},{key:"sendEventProxy",value:function(e,t,n,r,i){return e.nodeType===Node.ELEMENT_NODE?this.sendEvent({value:n,label:i,action:t,contextNode:e,customParams:r}):this.sendEvent(e)}},{key:"sendItemViewEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,i=e.customParams;this.sendItemViewEvent({contextNode:t,label:n,value:r,customParams:ce({contextNode:t,customParams:i})})}},{key:"sendClickEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,i=e.customParams,o=e.destinationUrl,a=e.isNewTab;if(a&&"boolean"!=typeof a)throw new Error("isNewTab property must be boolean");this.sendClickEvent({contextNode:t,label:n,value:r,customParams:ue({contextNode:t,destinationUrl:o,customParams:i,isNewTab:a})})}},{key:"sendContextmenuEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,i=e.customParams,o=e.destinationUrl;this.sendContextmenuEvent({contextNode:t,label:n,value:r,customParams:ue({contextNode:t,destinationUrl:o,customParams:i})})}},{key:"sendBoxInteractionEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,i=e.customParams;this.sendBoxInteractionEvent({contextNode:t,label:n,value:r,customParams:le({contextNode:t,customParams:i})})}},{key:"updateCustomParams",value:function(e){var t=e.pv,n=void 0===t?{}:t,r=e.ev,i=void 0===r?{}:r;k(n)&&k(i)?this.defaultCustomParams={pv:n,ev:i}:console.log("Can not update custom params with non-object arguments!")}},{key:"registerEventCallback",value:function(e){e&&!this.eventCallbacks.includes(e)&&this.eventCallbacks.push(e)}},{key:"createAPI",value:function(){return{sendPageView:this.sendPageViewProxy.bind(this),sendEvent:this.sendEventProxy.bind(this),sendItemViewEvent:this.sendItemViewEventProxy.bind(this),sendClickEvent:this.sendClickEventProxy.bind(this),sendContextmenuEvent:this.sendContextmenuEventProxy.bind(this),sendBoxInteractionEvent:this.sendBoxInteractionEventProxy.bind(this),registerEventCallback:this.registerEventCallback.bind(this)}}}]),e}();function me(e){return!k(e)||"clientImplementationVersion"in e?e:Object.assign(e,{clientImplementationVersion:""})}function pe(e){var t=e.instance,n=e.method,r=e.reportError,i=e.data,o=void 0===i?null:i,a=e.onSuccess,s=void 0===a?function(){}:a;if(t&&x(t[n]))try{t[n](o),s()}catch(e){r(e)}}function ge(e,t){return""===t?e:"".concat(e,"@").concat(t)}var be=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.targetWindow,i=t.services,o=t.reportError,a=t.unmountNodeCallback,s=t.mountNodeCallback;n(this,e),this.targetWindow=r,this.services=i,this.implementations=new Map,this.instances=new Map,this.reportError=o,this.unmountNodeCallback=a,this.mountNodeCallback=s}return i(e,[{key:"unmountNode",value:function(e){var t=this;this.unmountNodeCallback(e),S(e,"[data-prototype-id]").concat([e]).forEach((function(e){var n=e.getAttribute("data-box-id")||e.getAttribute("data-box-name");pe({instance:t.instances.get(n),method:"onUnmount",reportError:t.reportError}),t.instances.set(n,null)}))}},{key:"mountNode",value:function(e){var t=this;S(e,"[data-prototype-id]").concat([e]).forEach((function(e){var n=e.getAttribute("data-prototype-id"),r=e.getAttribute("data-civ")||"";t.registerInstancesForPrototype(n,r,[e])})),this.mountNodeCallback(e)}},{key:"isPrototypeObjectValid",value:function(e){var n=e.prototypeName,r=e.clientImplementationVersion;return"prototypeName"in e?""===n?(this.reportError(new Error('Property "prototypeName" cannot be empty string')),!1):E(n)?!!E(r)||(this.reportError(new Error('Property "clientImplementationVersion" must be string but got '.concat(t(r)))),!1):(this.reportError(new Error('Property "prototypeName" must be string but got '.concat(t(n)))),!1):(this.reportError(new Error('Property "handledPrototype" must have "prototypeName" field')),!1)}},{key:"containsValidPrototypes",value:function(e){var t=this;return 0===e.length?(this.reportError(new Error("Empty handledPrototypes list")),!1):!e.filter((function(e){return!t.isPrototypeObjectValid(e)})).length}},{key:"isPrototypeValid",value:function(e){return y(e)?this.containsValidPrototypes(e):k(e)?this.isPrototypeObjectValid(e):(this.reportError(new Error('"handledPrototype" argument must be an object or an array')),!1)}},{key:"isImplementationValid",value:function(e){return x(e)?e.prototype.onUpdate&&!x(e.prototype.onUpdate)?(this.reportError(new Error('"onUpdate" property must be a function or undefined but got '.concat(t(e.prototype.onUpdate)))),!1):!!x(e.prototype.onMount)||(this.reportError(new Error('"implementation" class has to have "onMount" method')),!1):(this.reportError(new Error('"implementation" must be a class')),!1)}},{key:"registerInstancesForPrototype",value:function(e,t,n){var r=this.implementations.get(ge(e,t));r&&this.registerInstances(n,this.services.getServicesForComponent(e),r)}},{key:"registerImplementationAndInstances",value:function(e,t){var n=e.prototypeName,r=e.clientImplementationVersion,i=ge(n,r),o=""===r;this.implementations.has(i)?this.reportError(new Error("".concat(n," ").concat(o?"":"with ".concat(r," client implementation version "),"already registered!"))):(this.implementations.set(i,t),this.registerInstancesForPrototype(n,r,S(this.targetWindow.document,'[data-prototype-id="'.concat(n,'"]').concat(o?"":'[data-civ="'.concat(r,'"]')))))}},{key:"updateComponentCallback",value:function(e,t){pe({instance:this.instances.get(e),method:"onUpdate",reportError:this.reportError,data:t})}},{key:"beforeUpdateComponentCallback",value:function(){var e=this;this.instances.forEach((function(t){return pe({instance:t,method:"beforeOnUpdate",reportError:e.reportError})}))}},{key:"getSerializedPropsFromNode",value:function(e){if(!e)return{};try{return JSON.parse(e.textContent)}catch(e){return this.reportError(e),{}}}},{key:"getSerializedPropsForBox",value:function(e,t){var n=[e?'[data-serialize-box-id="'.concat(e,'"]'):null,t?'[data-serialize-box-name="'.concat(t,'"]'):null].filter(Boolean).join(", "),r=this.targetWindow.document.querySelector(n);return r?this.getSerializedPropsFromNode(r):{}}},{key:"registerInstances",value:function(e,t,n){var r=this;e.forEach((function(e){if(!e.getAttribute("data-pathname")){var i=e.getAttribute("data-box-name"),o=e.getAttribute("data-box-id"),a=r.getSerializedPropsForBox(o,i),s=new n({baseNode:e,props:a,services:t}),c=o||i;pe({instance:s,method:"onMount",reportError:r.reportError,onSuccess:function(){r.instances.set(c,s)}})}}))}},{key:"register",value:function(e,t){var n=this,r=function(e){return y(e)?e.map(me):me(e)}(e);this.isPrototypeValid(r)&&this.isImplementationValid(t)&&(y(r)?r.forEach((function(e){n.registerImplementationAndInstances(e,t)})):this.registerImplementationAndInstances(r,t))}},{key:"createPublicAPI",value:function(){return{register:this.register.bind(this)}}},{key:"createPrivateAPI",value:function(){return{updateComponentCallback:this.updateComponentCallback.bind(this),beforeUpdateComponentCallback:this.beforeUpdateComponentCallback.bind(this),unmountNode:this.unmountNode.bind(this),mountNode:this.mountNode.bind(this)}}}]),e}(),ye=function(){return Promise.reject(new Error("missing edge host"))},ke=function(){function e(t){var r=t.httpClient,i=t.edgeHost,o=t.language;n(this,e),this.edgeHost=i,this.httpClient=r,this.defaultRequestSettings={headers:{"Content-type":"application/vnd.allegro.public.v1+json",Accept:"application/vnd.allegro.public.v1+json","Accept-Language":o}}}return i(e,[{key:"prepareRequestSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.disableDefaultHeaders)return e;var t=this.normalizeSettings(e);return te({},this.defaultRequestSettings,t)}},{key:"normalizeSettings",value:function(e){if(!e||!e.headers)return e;var n=function e(n,r){return Object.keys(n).reduce((function(i,o){var a=n[o],s="object"===t(a)?e(a,r):a;return i[r.find((function(e){return o.toLowerCase()===e.toLowerCase()}))||o]=s,i}),{})}(e.headers,Object.keys(this.defaultRequestSettings.headers));return b(e,{headers:n})}},{key:"prepareRequestUrl",value:function(e){return this.edgeHost+e}},{key:"get",value:function(e,t){return this.httpClient.get(this.prepareRequestUrl(e),this.prepareRequestSettings(t))}},{key:"put",value:function(e,t,n){return this.httpClient.put(this.prepareRequestUrl(e),t,this.prepareRequestSettings(n))}},{key:"post",value:function(e,t,n){return this.httpClient.post(this.prepareRequestUrl(e),t,this.prepareRequestSettings(n))}},{key:"patch",value:function(e,t,n){return this.httpClient.patch(this.prepareRequestUrl(e),t,this.prepareRequestSettings(n))}},{key:"delete",value:function(e,t){return this.httpClient.delete(this.prepareRequestUrl(e),this.prepareRequestSettings(t))}},{key:"createAPI",value:function(){return this.edgeHost?{get:this.get.bind(this),put:this.put.bind(this),post:this.post.bind(this),patch:this.patch.bind(this),delete:this.delete.bind(this)}:{get:ye,put:ye,post:ye,patch:ye,delete:ye}}}]),e}(),Ee=function(){function e(t){var r=t.targetWindow,i=t.alias,o=void 0===i?"cm":i,a=t.config,s=void 0===a?{}:a,c=t.isExternal,u=void 0!==c&&c;n(this,e);var l=s.cookieMonster,d=l.host,h=l.account,f=l.defaultCustomParams,v=void 0===f?{}:f,m=l.referrer,p=void 0===m?document.referrer:m;this.targetWindow=r,this.document=this.targetWindow.document,this.alias=o,this.host=d,this.account=h,this.isExternal=u,this.defaultCustomParams=v,this.referrer=p}return i(e,[{key:"initialize",value:function(){if(this.isExternal)return this.loadExternal(),void this.callCookieMonster.call(this,"create",this.account);this.host&&this.account&&!this.isLoaded()?(this.load(),this.callCookieMonster.call(this,"create",this.account),this.sendPageView(),this.updateReferrer()):this.updateReferrer()}},{key:"load",value:function(){this.isLoaded()||function(e,t,n,r,i){e["cm.analytics.object"]=i,e[i]=e[i]||function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e[i].q=e[i].q||[]).push(n)};var o=A(t,"script",{src:r}),a=t.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)}(this.targetWindow,this.document,0,this.host,this.alias)}},{key:"loadExternal",value:function(){this.isLoaded()||function(e,t){e["cm.analytics.object"]=t,e[t]=e[t]||function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];(e[t].q=e[t].q||[]).push(r)}}(this.targetWindow,this.alias)}},{key:"send",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.callCookieMonster).call.apply(e,[this,this.sendCommand()].concat(n))}},{key:"sendPageView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultCustomParams.pv||{};this.send("pageview",{customParams:e,referrer:this.referrer})}},{key:"updateReferrer",value:function(){this.referrer=window.location.href}},{key:"callCookieMonster",value:function(){if(this.isLoaded()){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.targetWindow[this.alias].apply(null,t)}}},{key:"isLoaded",value:function(){return"function"==typeof this.targetWindow[this.alias]}},{key:"sendCommand",value:function(){return"send@".concat(this.account)}}]),e}(),we=re,xe=ne,Ce=function(e,t,n,r){return e>0?e<n?t<n?t-e:n-e:0:t<0?0:t<n?t:r},Pe=function(e){return{width:e.innerWidth,height:e.innerHeight}},Se=function(){function e(t){var r,i,o,a,s=t.targetWindow,c=t.boxes,u=void 0===c?[]:c,l=t.significantElementSizePercentage,d=void 0===l?.75:l,h=t.timeoutValue,f=void 0===h?500:h,v=t.debounceTimeoutValue,m=void 0===v?20:v;n(this,e),this.targetWindow=s,this.config={timeoutValue:f,debounceTimeoutValue:m,significantElementSizePercentage:d},this.resetState(),this.boxes=u.length?u:we(s.document),this.visibleElements=[],this.scrollHandlerWithContext=this.scrollHandler.bind(this),this.scrollEndHandler=R(this.resetCurrentlyVisibleElementsAfterScroll,this.config.debounceTimeoutValue),this.resizeEndHandler=R(this.resizeHandler.bind(this),this.config.debounceTimeoutValue),this.resetCurrentlyVisibleElementsOnTimeout=(r=this.resetCurrentlyVisibleElements.bind(this),i=this.config.debounceTimeoutValue,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=this;return new Promise((function(e){var n=o&&!a;clearTimeout(a),a=setTimeout((function(){a=null,o||e(r.apply(s,t))}),i),n&&e(r.apply(s,t))}))}),this.markCurrentlyVisibleElementsAsSeenOnTimeout=R(this.markCurrentlyVisibleElementsAsSeen.bind(this),this.config.timeoutValue)}return i(e,[{key:"setUserViewport",value:function(){this.state.userViewport=Pe(this.targetWindow)}},{key:"resetState",value:function(){var e=(new Date).getTime();this.state={isScrolling:!1,scrollStartTime:e,counterStartTime:e,userViewport:Pe(this.targetWindow)}}},{key:"createEvent",value:function(e){var t;try{(t=this.targetWindow.document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,{})}catch(n){t=new CustomEvent(e,{cancelable:!0,bubbles:!0})}return t}},{key:"isSignificantPartOfElementVisible",value:function(e){var t=e.right-e.left,n=e.bottom-e.top,r=Ce(e.left,e.right,this.state.userViewport.width,t);return Ce(e.top,e.bottom,this.state.userViewport.height,n)*r/(t*n)>this.config.significantElementSizePercentage}},{key:"putVisibleElementsToBuffer",value:function(){var e=!1,t=this.visibleElements.slice();this.visibleElements=[];for(var n=0;n<this.boxes.length;n+=1){var r=null;try{r=this.boxes[n].getBoundingClientRect()}catch(t){e=!0,this.boxes[n]=null}r&&(this.isSignificantPartOfElementVisible(r)?(this.visibleElements.push(this.boxes[n]),-1===t.indexOf(this.boxes[n])&&this.boxes[n].dispatchEvent(this.createEvent("inViewport"))):-1!==t.indexOf(this.boxes[n])&&this.boxes[n].dispatchEvent(this.createEvent("outOfViewport")))}e&&(this.boxes=this.boxes.filter((function(e){return null!==e})),we(this.targetWindow.document).forEach(this.addBox.bind(this)))}},{key:"markElementAsSeen",value:function(e,t){if(e){var n=parseInt(e.getAttribute("data-visible-for"),10)||0;(!e.getAttribute("data-seen")&&n+t)>=this.config.timeoutValue&&(e.setAttribute("data-seen",!0),e.dispatchEvent(this.createEvent("boxView"))),e.setAttribute("data-visible-for",n+t)}}},{key:"markPreviouslyVisibleElementsAsSeen",value:function(){var e=this,t=(new Date).getTime();this.visibleElements.forEach((function(n){e.markElementAsSeen(n,t-e.state.counterStartTime)}))}},{key:"markPreviouslyVisibleElementsAsSeenAfterScroll",value:function(){var e=this;this.visibleElements.forEach((function(t){e.markElementAsSeen(t,e.state.scrollStartTime-e.state.counterStartTime)}))}},{key:"markCurrentlyVisibleElementsAsSeen",value:function(){var e=this;this.visibleElements.forEach((function(t){e.markElementAsSeen(t,e.config.timeoutValue)}))}},{key:"resetCurrentlyVisibleElements",value:function(){this.markPreviouslyVisibleElementsAsSeen(),this.putVisibleElementsToBuffer(),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}},{key:"resetCurrentlyVisibleElementsAfterScroll",value:function(){this.markPreviouslyVisibleElementsAsSeenAfterScroll(),this.putVisibleElementsToBuffer(),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}},{key:"scrollHandler",value:function(){this.state.isScrolling||(this.state.scrollStartTime=(new Date).getTime(),this.state.isScrolling=!0),clearTimeout(this.markCurrentlyVisibleElementsAsSeenOnTimeout()),this.scrollEndHandler()}},{key:"resizeHandler",value:function(){this.setUserViewport(),this.resetCurrentlyVisibleElements()}},{key:"addBox",value:function(e){-1===this.boxes.indexOf(e)&&this.boxes.push(e)}},{key:"isBoxInViewport",value:function(e){return-1!==this.visibleElements.indexOf(e)}},{key:"clearAttributes",value:function(e){this.boxes.forEach((function(t){t&&t.matches(e)&&(t.removeAttribute("data-seen"),t.removeAttribute("data-visible-for"))}))}},{key:"markBoxAsRendered",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t&&this.clearAttributes(t),e.getAttribute("data-analytics-enabled")&&this.addBox(e),we(e).forEach(this.addBox.bind(this)),this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"markBoxAsVisible",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.addBox(e),t?this.markElementAsSeen(e,this.config.timeoutValue):this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"recursivelyMarkBoxAsVisible",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.markBoxAsVisible(e,n),re(e).forEach((function(e){return t.markBoxAsVisible(e,n)}))}},{key:"removeBox",value:function(e){this.boxes=this.boxes.filter((function(t){return t!==e})),this.visibleElements=this.visibleElements.filter((function(t){return t!==e}))}},{key:"markBoxAsHidden",value:function(e){this.removeBox(e),this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"unmountNode",value:function(e){var t=this;xe(e).forEach((function(e){return t.removeBox(e)}))}},{key:"recursivelyMarkBoxAsHidden",value:function(e){var t=this;this.markBoxAsHidden(e),re(e).forEach((function(e){return t.markBoxAsHidden(e)}))}},{key:"trackBoxScroll",value:function(e){e.addEventListener("scroll",this.scrollHandlerWithContext)}},{key:"initialize",value:function(){this.targetWindow.addEventListener("scroll",this.scrollHandlerWithContext),this.targetWindow.addEventListener("resize",this.resizeEndHandler),this.resetCurrentlyVisibleElements()}},{key:"createAPI",value:function(){return{markBoxAsRendered:this.markBoxAsRendered.bind(this),markBoxAsVisible:this.markBoxAsVisible.bind(this),recursivelyMarkBoxAsVisible:this.recursivelyMarkBoxAsVisible.bind(this),markBoxAsHidden:this.markBoxAsHidden.bind(this),recursivelyMarkBoxAsHidden:this.recursivelyMarkBoxAsHidden.bind(this),trackBoxScroll:this.trackBoxScroll.bind(this),isBoxInViewport:this.isBoxInViewport.bind(this)}}}]),e}(),Ae=function(e){return function(t){0===t.status||(e.newrelic?(console.error("Reporting error to newrelic: ".concat(t.message)),e.newrelic.noticeError(t)):console.error("Error: ".concat(t.message)))}},Te=function(e){var t=e.origin,n=e.pathname,r=e.search;return"".concat(t).concat(n).concat(r)},Ne=function(e,t){function n(e){for(var t,n,r,i,o=new RegExp("([^&=]+)=?([^&]*)","g"),a={},s=e.substring(e.indexOf("?")+1,e.length);t=o.exec(s);)n=a,r=decodeURIComponent(t[1]),i=decodeURIComponent("string"===t[1]?t[2].replace(/\+/g," "):t[2]),void 0===n[r]?n[r]=[i]:n[r].push(i);return a}var r,i=n(e),o=function(e,t){for(var n=0,r=e.length;n<r;n+=1)if(t(e[n],n,e))return e[n];return null}(i,function(e){return function(t){return t.name===e}}("route"));function a(e){t.forEach((function(t){return n=e,r=t.name,i=t.value,void(n[r]=Array.isArray(i)?i:[i]);var n,r,i}))}function s(e){return Object.keys(e).map((function(t){return e[t].map((function(e){return[t,e]}))})).reduce(V,[]).reduce((function(e,t){var n=h(t,2),r=n[0],i=n[1];return null!=i?"".concat(e).concat((e?"&":"?")+encodeURIComponent(r),"=").concat(encodeURIComponent(i)):e}),"")}return o&&0===o.value.indexOf("http")?(a(r=2===o.value.split("?").length?n(o.value.split("?")[1]):[]),o.value=o.value.split("?")[0]+s(r)):a(i),s(i)},Ie=function(){function e(t){var r=t.targetWindow,i=t.opboxWebClient,o=t.rawDataListenersRegistry;n(this,e),this.targetWindow=r,this.opboxWebClient=i,this.rawDataListenersRegistry=o,this.history=[r.location.pathname],this.recentlyFetchedURL=Te(r.location)}return i(e,[{key:"initialize",value:function(){var e=this;this.targetWindow.onpopstate=function(t){return e.handlePopState(t)},this.targetWindow.history.replaceState({opboxjs:!0},"")}},{key:"isInternalNavigation",value:function(e){return this.history.find((function(t){return t===e}))}},{key:"navigateRelative",value:function(e){var t=this.targetWindow.location,n=t.pathname,r=t.search,i=n+r,o=n+Ne(r,e);return this.changeUrl(o),this.history.push(n),this.targetWindow.performance.mark("clientSideNavigationStart"),o!==i&&this.fetch(o),o}},{key:"refreshPage",value:function(){var e=this.targetWindow.location,t=e.pathname+e.search;this.fetch(t)}},{key:"changeUrl",value:function(e){return this.targetWindow.history.pushState("","",e)}},{key:"handlePopState",value:function(e){var t=e.target.location.pathname,n=Te(e.target.location);this.isInternalNavigation(t)&&this.recentlyFetchedURL!==n&&this.refreshPage()}},{key:"fetch",value:function(e){var t=this;this.recentlyFetchedURL=Te(this.targetWindow.location),this.rawDataListenersRegistry.triggerProgressListener(),this.opboxWebClient.getPageData(e).then((function(e){return t.rawDataListenersRegistry.triggerChangeListener(e)})).catch(Ae)}}]),e}(),Oe="opboxAnimationTimerInterval",Re=function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},Ve=function(e){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(e){setTimeout(e,1e3/60)}};function je(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=i.duration,a=void 0===o?500:o,s=i.onFinish;if("function"!=typeof r)return null;var c=Ve(e),u=Date.now(),l=n-t,d=!1,h=function(){d=!0},f=function e(){var n=Date.now()-u;if(d||n>=a)"function"==typeof s&&s(),d=!1;else{var i=Math.min(n/a,1),o=Re(i)*l+t;r(o),c(e)}};return f(),{stop:h}}function Me(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.duration,i=void 0===r?500:r,o=e.pageYOffset,a=Math.max(0,t),s=e.document.body.scrollHeight;function c(t){var n=t===a||t===a,r=e.innerHeight+t>=s;return n||r}function u(){e[Oe]&&"function"==typeof e[Oe].stop&&(e[Oe].stop(),e[Oe]=null)}var l=function(t){e.scrollTo(0,Math.round(t)),c(t)&&u()};u(),e[Oe]=je(e,o,t,l,{duration:i})}function We(e,t){return function(n){if(!e.has(n))return Promise.reject(new Error("Service ".concat(n," is not registered")));var r=e.get(n);return r.fetchIfNotFetched(t),r.promise}}var Be=function(){function e(t){var r=this,i=t.prototypeName,o=t.servicesRegistry,a=t.targetWindow;n(this,e),this.services=new Map,this.targetWindow=a,o.forEach((function(e,t){e.components.some((function(e){return e.prototypeName===i}))&&r.services.set(t,e)})),this.get=We(this.services,this.targetWindow)}return i(e,[{key:"has",value:function(e){return this.services.has(e)}}]),e}();function Le(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.inHead,i=void 0!==r&&r,o=n.referenceNode,a=void 0===o?null:o;return function(n){if(C(n))return null;var r=A(e.document,"link",n,{rel:t});if(a)T(a,r);else{var o=i?"head":"body";e.document[o].appendChild(r)}return r}}var Ue=["spinner","button","link","badge","brand","bubble","card","chart","desk","divider","heading","hint","icon","indicator","input","list","timeline","marker","notification","placeholder","price","progress","table","dropdown","breadcrumb","accordion","carousel","chip","choice","dialog","field","image-tile","input-group","message","modal","pagination","range","select","sheet","slider","soap","stepper","tabs","typography","color","grid","calendar","attachment","article","navigation-tiles","pin","player-video","align","border","box-sizing","display","flex","height","margin","padding","position","transition","utils","visibility","white-space","width","zindex","core"],He=function(e,t,n){var r=Le(e,"stylesheet",{inHead:!0,referenceNode:n})({type:"text/css",href:t});return new Promise((function(e,t){r.addEventListener("error",t),r.addEventListener("load",e)}))},De=function(e){return function(t){return-1!==t.href.indexOf(e)}};function qe(e,t){var n=t.metrum,r=n.isBundleEnabled,i=n.emptyRule,o=n.bundleUrl,a=r?function(e,t){return P(e.document.styleSheets).find((function(e){var n=e.href;return n&&n===t}))}(e,o):null,s=[];return{isBundleEnabled:r,inject:function(t){if(!r)return Promise.resolve();var n=function(e,t){return t.reduce((function(t,n){var r=h(t,2),i=r[0],o=r[1];return e.includes(n)||o.push(n),i.push(n),[i,o]}),[[],[]])}(s,t),o=h(n,2),c=o[0],u=o[1];return s=c,u.length?function(e,t){var n=A(e,"iframe",{style:"display:none"}),r=function(){return e.body.removeChild(n)};e.body.appendChild(n);var i=n.contentDocument,o=n.contentWindow;return i.open("text/html","replace"),i.write(t.map(H).join("")),i.close(),new Promise((function(e){var n=function(){return e([P(i.styleSheets),r])};"complete"===i.readyState&&i.styleSheets.length===t.length?n():o.addEventListener("load",(function e(){o.removeEventListener("load",e),n()}))}))}(e.document,u).then((function(e){var t=h(e,2),n=t[0],r=t[1];n.forEach((function(e){if(!function(e,t){return t.cssRules.length>0&&P(e.cssRules).findIndex((function(e){return e.cssText===t.cssRules[0].cssText}))>-1}(a,e))for(var t=I(e.href),n=function(e,t){return P(e.cssRules).findIndex((function(e){return e.selectorText===t}))}(a,function(e){return i.pattern.replace(i.replacementPart,e)}(t)),r=n>0?n:a.cssRules.length,o=P(e.cssRules),s=0;s<o.length;s+=1)a.insertRule(o[s].cssText,r+s)})),r()})):Promise.resolve()}}}function ze(e,t,n,r){var i=I(n);return r.includes(i)?He(e,n,function(e,t,n){var r=e.filter((function(e){return e.isMetrum})),i=t.slice(0,t.indexOf(n)).reverse().find((function(e){return r.find(De(e))})),o=i?r.find(De(i)).node:null;return!o&&r.length?r[0].node.previousElementSibling:!o&&e.length?e[0].node.previousElementSibling:o}(t,r,i)):Promise.resolve()}function Fe(e,t,n){var r=n.url,i=n.code;return N(r)?ze(e,t,r,Ue):r?He(e,r):i?function(e,t){var n=A(e.document,"style",{innerHTML:t});return e.document.head.appendChild(n),Promise.resolve()}(e,i):Promise.reject()}var _e;function Je(e,t){return t.filter((function(t){return!e.find((n=t,function(e){return n.url?n.url===e.url||n.url===e.href||n.url===e.src:!!n.code&&n.code===e.code}));var n}))}function Xe(e,t,n){if(!t.length)return Promise.resolve();var r=function(e){return S(e,'link[type="text/css"],style',(function(e){return{href:e.href,code:e.innerHTML,node:e,isMetrum:N(e.href)}})).filter((function(e){var t=e.href,n=e.code;return t||n}))}(e.document),i=Je(r,t),o=_e=_e&&!_e.forceRefresh?_e:qe(e,n),a=o.inject,s=o.isBundleEnabled,c=i.reduce((function(t,n){return N(n.url)&&s?(t.metrumStyles.push(n.url),t):(t.injectedStyles.push(Fe(e,r,n)),t)}),{metrumStyles:[],injectedStyles:[]}),u=c.metrumStyles,l=c.injectedStyles;return l.push(a(u)),Promise.all(l)}function Ye(e,t){if(!t.length)return Promise.resolve();var n=function(e){return P(e.document.getElementsByTagName("script"),(function(e){return{src:e.src,code:e.innerHTML,nonce:e.nonce}}))}(e),r=function(e){return(e.find((function(e){return!!e.nonce}))||{}).nonce}(n),i=Je(n,t);return Promise.all(i.map(function(e,t){var n=Ae(e),r=function(e){return"noModule"in e.document.createElement("script")}(e);return function(i){var o=i.url,a=i.code,s=i.attributes,c=i.type,u=i.async;return o||a?new Promise((function(i){var l,d=!o&&!!a,f="module"===c,v=A(e.document,"script"),m=function e(t){i(),t.message||(t.message="Error while loading script: ".concat(o)),n(t),v.removeEventListener("error",e)};if(!f||r){if(s){if(s.nomodule&&r)return void i();Object.entries(s).forEach((function(t){var n=h(t,2),r=n[0],i=n[1];"data-serialize-box-id"!==r&&"data-serialize-box-name"!==r||(l=e.document.querySelector("[".concat(r,'="').concat(i,'"]'))),v.setAttribute(r,i)}))}t&&v.setAttribute("nonce",t),u&&v.setAttribute("async","async"),c&&(v.type=c),d?(v.innerHTML=a,i()):(v.src=o,v.addEventListener("load",(function e(){i(),v.removeEventListener("error",m),v.removeEventListener("load",e)})),v.addEventListener("error",m)),l?l.parentNode.replaceChild(v,l):e.document.body.appendChild(v)}else i()})):Promise.resolve()}}(e,r)))}function Ge(e,t,n){var r=t.svgColorMatrixFilters,i=void 0===r?"":r,o=t.assets,a=o.scripts,s=void 0===a?[]:a,c=o.styles,u=void 0===c?[]:c,l=o.prefetches,d=void 0===l?[]:l,h=o.preloads,f=void 0===h?[]:h;return function(e,t){var n=e.document;if(t){var r=n.querySelector("#svg-color-matrix-filters"),i=A(n,"div",{innerHTML:t}).querySelector("svg");r?S(i,"filter",(function(e){r.querySelector("#".concat(e.getAttribute("id")))||r.appendChild(e)})):n.body.insertBefore(i,n.body.firstChild)}}(e,i),function(e,t){t.forEach(Le(e,"preload"))}(e,f),function(e,t){t.forEach(Le(e,"prefetch"))}(e,d),Promise.all([Ye(e,s),Xe(e,u,n)])}var Qe=function(){function e(t){var r=this,i=t.assetUrl,o=t.components,a=t.reportError;n(this,e),this.assetUrl=i,this.components=o,this.reportError=a,this.implementation=null,this.status=0,this.promise=new Promise((function(e,t){r.resolve=e,r.reject=t}))}return i(e,[{key:"update",value:function(e){this.components=function(e,t){return t.reduce((function(e,t){return e.find((function(e){return e.prototypeName===t.prototypeName}))?e:e.concat(t)}),e)}(this.components,e)}},{key:"registerImplementation",value:function(e){try{this.implementation=new e,this.status=2,this.resolve(this.implementation)}catch(e){this.handleError(e)}}},{key:"fetchIfNotFetched",value:function(e){var t=this;0===this.status&&(this.status=1,Ye(e,[{url:this.assetUrl}]).catch((function(e){t.handleError(e)})))}},{key:"handleError",value:function(e){this.reportError(e),this.status=2,this.reject()}}]),e}(),$e=function(){function e(t){var r=this,i=t.targetWindow,o=t.reportError;n(this,e),this.targetWindow=i,this.reportError=o,this.servicesRegistry=new Map;var a=this.targetWindow.document.querySelector('[data-config="services"]');if(a)try{JSON.parse(a.textContent).forEach((function(e){var t=h(e,2),n=t[0],i=t[1],o=i.assetUrl,a=i.components;r.setServiceToRegistry(n,o,a)}))}catch(e){this.reportError(e)}this.dangerouslyGet=We(this.servicesRegistry,this.targetWindow),this.update=this.update.bind(this)}return i(e,[{key:"getServicesForComponent",value:function(e){return new Be({prototypeName:e,servicesRegistry:this.servicesRegistry,targetWindow:this.targetWindow})}},{key:"setServiceToRegistry",value:function(e,t,n){this.servicesRegistry.set(e,new Qe({assetUrl:t,components:n,reportError:this.reportError}))}},{key:"update",value:function(e){var t=this;e.forEach((function(e){var n=h(e,2),r=n[0],i=n[1],o=i.assetUrl,a=i.components;t.servicesRegistry.has(r)?t.servicesRegistry.get(r).update(a):t.setServiceToRegistry(r,o,a)}))}},{key:"register",value:function(e,t){var n=e.serviceName;this.servicesRegistry.get(n).registerImplementation(t)}},{key:"createAPI",value:function(){return{register:this.register.bind(this),__dangerouslyGet__:this.dangerouslyGet.bind(this)}}}]),e}();function Ke(e,n){e.forEach((function(e){var r=e.args,i=e.reject,o=e.resolve,a=function(e,n){try{return e.apply(void 0,f(n))}catch(e){return console.error(e),void("object"===t("NREUM")&&null!==NREUM&&"function"==typeof NREUM.noticeError&&NREUM.noticeError(e))}}(n,r);a&&x(a.then)&&x(o)&&x(i)&&a.then(o,i)}))}var Ze=function(){return Date.now()};var et=function(){function e(t){var r=t.localStorage,i=t.reportError,o=t.ttlMs,a=void 0===o?2592e6:o,s=t.key,c=void 0===s?"opbox.preferences":s,u=t.timeProvider,l=void 0===u?Ze:u;n(this,e),this.writeToStorage=this.writeToStorage.bind(this),this.loadPreferences=this.loadPreferences.bind(this),this.cleanupPreferences=this.cleanupPreferences.bind(this),this.savePreferences=this.savePreferences.bind(this),this.storage=function(e){try{var t="test_preferences_storage";return e.setItem(t,t),e.getItem(t),e.removeItem(t),!0}catch(e){return!1}}(r)?r:{setItem:function(){},getItem:function(){return{}}},this.ttlMs=a,this.key=c,this.timeProvider=l,this.reportError=i}return i(e,[{key:"savePreferences",value:function(e){var t=this.loadPreferences(),n=this.timeProvider(),r=e.reduce(B((function(e){return o({},e.name,{value:e.value,timestamp:n})})),t);this.writeToStorage(r)}},{key:"writeToStorage",value:function(e){try{this.storage.setItem(this.key,JSON.stringify(e))}catch(e){this.reportError(e)}}},{key:"loadPreferences",value:function(){try{return JSON.parse(this.storage.getItem(this.key))||{}}catch(e){return this.reportError(e),{}}}},{key:"cleanupPreferences",value:function(){var e=this,t=this.loadPreferences(),n=this.timeProvider(),r=Object.entries(t).reduce(B((function(t){var r=h(t,2),i=r[0],a=r[1];return a.timestamp+e.ttlMs>n?o({},i,a):{}})),{});this.writeToStorage(r)}}]),e}(),tt={withCredentials:!0,headers:{"Content-type":"application/vnd.allegro.internal.v1+json",Accept:"application/vnd.allegro.internal.v1+json"}},nt=function(){function e(t){var r=t.edgeClient,i=t.localStorage,o=t.ttlMs,a=t.reportError;n(this,e),this.edgeClient=r,this.storage=new et({localStorage:i,ttlMs:o,reportError:a}),this.setPreference=this.setPreference.bind(this),this.getPreference=this.getPreference.bind(this),this.getPreferences=this.getPreferences.bind(this),this.getPreferencesFromLocalStorageOrDefaults=this.getPreferencesFromLocalStorageOrDefaults.bind(this)}return i(e,[{key:"setPreference",value:function(e,t){var n={name:e,value:t};return this.storage.savePreferences([n]),this.edgeClient.post("/preferences",n,tt)}},{key:"getPreference",value:function(e,t){return"string"==typeof e||e instanceof String?this.getPreferences(o({},e,t)).then((function(t){return t[e]})):Promise.reject(Error("illegal argument type provided as preference name"))}},{key:"getPreferences",value:function(e){var n=this;if("object"!==t(e))return Promise.reject(Error("illegal argument type provided as preferences"));var r=Object.keys(e).join(","),i="".concat("/preferences","?name=").concat(r);return this.edgeClient.get(i,tt).then((function(e){return n.storage.savePreferences(e.data.preferences),e.data.preferences.reduce(B((function(e){return o({},e.name,e.value)})),{})})).catch((function(){return n.getPreferencesFromLocalStorageOrDefaults(e)}))}},{key:"getPreferencesFromLocalStorageOrDefaults",value:function(e){this.storage.cleanupPreferences();var t=this.storage.loadPreferences();return Object.entries(e).reduce(B((function(e){var n=h(e,2),r=n[0],i=n[1];return o({},r,r in t?t[r].value:i)})),{})}},{key:"createAPI",value:function(){return{set:this.setPreference,get:this.getPreference,getMany:this.getPreferences}}}]),e}();function rt(e,t){var n=e.navigator.serviceWorker,r=e.location.href;n&&(function(e,t,n){"function"==typeof e.addEventListener&&e.addEventListener("message",(function(e){"installed"===e.data&&t("event","PWA","serviceworker-registered",null,n)}))}(n,t,r),function(e,t){if("function"!=typeof e.getRegistrations)return Promise.resolve();var n=function(e){return e.unregister().then((function(t){return t?e.active.scriptURL:""}))};e.getRegistrations().then((function(e){return Promise.all(e.map(n))})).then((function(e){var n=e.filter(Boolean);n.length>0&&t("event","PWA","serviceworker-unregistered",null,n.join(","))}))}(n,t))}var it=function(e){var t=e.config,n=e.targetWindow,r=e.unmountNodeCallback,i=e.mountNodeCallback,o=e.updateServicesCallback,a=e.injectAssets,s=void 0===a?Ge:a;function c(e){return n.document.querySelector('[data-box-id="'.concat(e,'"]'))}return function(e){var a=e.boxId,u=e.data,l=e.isPlaceholder,d=u.htmlString,h=u.servicesConfig;return o(h),s(n,u,t).then((function(){var e=l?function(e){return n.document.querySelector('[data-placeholder-for="'.concat(e,'"]'))}(a):c(a);if(r(e),d){var t=A(n.document,"div",{innerHTML:d});e.parentNode.replaceChild(t.firstElementChild,e),i(c(a))}else e.parentNode.removeChild(e)}))}},ot=function(e){var t=e.config,n=e.targetWindow,r=e.unmountNodeCallback,i=e.mountNodeCallback,o=e.updateServicesCallback,a=e.injectAssets,s=void 0===a?Ge:a;function c(e,t){var r=A(n.document,"div",{innerHTML:t});return r.setAttribute("data-pathname",e),r}return function(e){var a=e.pathname,u=e.data,l=u.htmlString,d=u.servicesConfig;return o(d),s(n,u,t).then((function(){var e=function(e){return n.document.querySelector('[data-pathname="'.concat(e,'"]'))}(a);if(!e&&l){var t=c(a,l);return n.document.body.appendChild(t),void i(t)}if(e){if(r(e),!l)return void e.parentNode.removeChild(e);var o=c(a,l);e.parentNode.replaceChild(o,e),i(o)}}))}},at=new(function(){function e(t,r,i){n(this,e),this.targetWindow=t;var o=function(e){return D(e).config}(this.targetWindow),a=new z({targetWindow:t}),s=new Ee({targetWindow:t,config:o}),c=new Se({targetWindow:t}),u=new ve({targetWindow:t,config:o,cookieMonsterClient:s,boxViewsMarker:c,sendPerformanceMetrics:this.sendPerformanceMetrics.bind(this)}),l=Ae(t),d=new $e({targetWindow:t,reportError:l}),h=function(e){var t,n=new be(e);return{public:Object.assign({init:(t=e.targetWindow,function(e,n){var r=e.prototypeName;r&&n({domNodes:S(t.document,'[data-prototype-id="'.concat(r,'"]'))})})},n.createPublicAPI()),private:n.createPrivateAPI()}}({targetWindow:t,services:d,reportError:l,unmountNodeCallback:c.unmountNode.bind(c),mountNodeCallback:c.markBoxAsRendered.bind(c)}),f=new ee({appContext:a,analytics:u,updateComponentCallback:h.private.updateComponentCallback,beforeUpdateComponentCallback:h.private.beforeUpdateComponentCallback}),v={config:o,targetWindow:t,unmountNodeCallback:h.private.unmountNode,mountNodeCallback:h.private.mountNode,updateServicesCallback:d.update},m=new K({httpClient:r,reportError:l,fragmentRenderCallback:ot(v),boxRenderCallback:it(v)});this.config=o,this.cookieMonsterClient=s,this.boxViewsMarker=c,this.analytics=u,this.services=d,this.componentAPI=h,this.rawDataListenersRegistry=f,this.opboxWebClient=m,this.reportError=l,this.navigation=new Ie({targetWindow:t,opboxWebClient:m,rawDataListenersRegistry:f}),this.edgeClient=new ke({httpClient:i,edgeHost:o.edgeHost,language:o.language}),this.edgeUploadClient=new ke({httpClient:i,edgeHost:o.edgeUploadHost,language:o.language}),this.preferencesClient=new nt({edgeClient:this.edgeClient,localStorage:this.targetWindow.localStorage,reportError:this.reportError}),this.uiTools=function(e){var t=function(t){return"string"!=typeof t?null:e.document.querySelector('a[name="'.concat(t,'"]'))},n=function(t){var n=e.pageYOffset||e.document.documentElement.scrollTop||0;return t?t.getBoundingClientRect().top+n:null};return{getBoxAnchorNode:t,getTopOffset:n,scrollTo:function(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.animate,a=void 0===o||o,s={duration:a?500:0};if("number"!=typeof r){var c=t(r);if(c){var u=n(c);Me(e,u,s)}}else Me(e,r,s)},tween:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return je.apply(void 0,[e].concat(n))}}}(t),this.analytics.initialize(),this.navigation.initialize(),this.boxViewsMarker.initialize()}return i(e,[{key:"domReadyHelper",value:function(e){"loading"===this.targetWindow.document.readyState?this.targetWindow.document.addEventListener("DOMContentLoaded",e):this.targetWindow.setTimeout(e,0)}},{key:"lazyloadedElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.target,n=t.getAttribute("data-placeholder-for");n&&this.opboxWebClient.render.box({boxId:n,isPlaceholder:!0})}},{key:"renderBoxForLazyloadedPlaceholders",value:function(){var e=this;Array.from(this.targetWindow.document.querySelectorAll("[".concat("data-placeholder-for","].lazyloaded")),(function(t){var n=t.getAttribute("data-placeholder-for");return e.opboxWebClient.render.box({boxId:n,isPlaceholder:!0})}))}},{key:"broadcastAPILoadEvent",value:function(){var e=function(e,t){var n=t.document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,{}),n}("opboxAPILoaded",this.targetWindow);this.targetWindow.dispatchEvent(e)}},{key:"attach",value:function(){var e,t,n,r=this,i=D(this.targetWindow),o=this.API;i&&(!function e(t,n,r){for(var i=arguments.length,o=new Array(i>3?i-3:0),a=3;a<i;a++)o[a-3]=arguments[a];if(x(t)&&x(n)){if(!t.__queue__)return;Ke(t.__queue__,n),r.apply(void 0,[n].concat(o))}else k(t)&&k(n)&&Object.keys(t).forEach((function(i){e.apply(void 0,[t[i],n[i],r].concat(f(o.concat(i))))}))}(i,o,(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return q(r.targetWindow,j.apply(void 0,[i,e].concat(n)))})),e=i,n=o,t=Object.keys(n).concat("initialized","config"),Object.keys(e).forEach((function(n){t.includes(n)||delete e[n]})),Object.freeze(i)),rt(this.targetWindow,this.cookieMonsterClient.send.bind(this.cookieMonsterClient)),this.broadcastAPILoadEvent(),this.targetWindow.addEventListener("lazyloaded",this.lazyloadedElement.bind(this)),o.performance.markTimeToInteractive("opbox-web-browser")}},{key:"sendPerformanceMetrics",value:function(){this.targetWindow.pinter&&this.targetWindow.pinter.sendUserTimings&&this.targetWindow.pinter.sendUserTimings()}},{key:"run",value:function(){this.attach(),this.renderBoxForLazyloadedPlaceholders()}},{key:"API",get:function(){return{analytics:this.analytics.createAPI(),boxViewsMarker:this.boxViewsMarker.createAPI(),component:this.componentAPI.public,onData:this.rawDataListenersRegistry.registerListener.bind(this.rawDataListenersRegistry),changeParams:this.navigation.navigateRelative.bind(this.navigation),refreshPage:this.navigation.refreshPage.bind(this.navigation),tween:this.uiTools.tween,scrollTo:this.uiTools.scrollTo,page:this.opboxWebClient.createAPI(),edge:this.edgeClient.createAPI(),edgeUpload:this.edgeUploadClient.createAPI(),preferences:this.preferencesClient.createAPI(),onDomReady:this.domReadyHelper.bind(this),loaded:!0,performance:D(this.targetWindow).performance,services:this.services.createAPI(),reportError:this.reportError}}}]),e}())(window,g(),g());at.run();var st=at.attach.bind(at);return e.attach=st,e}({});